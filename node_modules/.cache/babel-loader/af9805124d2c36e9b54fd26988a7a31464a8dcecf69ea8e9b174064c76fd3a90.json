{"ast":null,"code":"import TreeLevelConnectorStackSize from '../../models/TreeLevelConnectorStackSize';\nimport TreeLevels from '../../algorithms/TreeLevels';\nimport Pile from '../../algorithms/Pile';\nimport { SideFlag } from '../../enums';\nimport VerticalConnectorBundle from '../../connectors/VerticalConnectorBundle';\nimport HorizontalConnectorBundle from '../../connectors/HorizontalConnectorBundle';\n\n/* Read visual tree\r\n    populate treeLevels array of type TreeLevel\r\n      TreeLevel object contains ordered list of all its items \r\n      plus when items added to that collection we store level in item\r\n*/\nexport default function VisualTreeLevelsTask(visualTreeTask, itemTemplateParamsTask) {\n  var _data = {\n      treeLevels: null,\n      /* TreeLevels */\n      bundles: null,\n      /* array of BaseConnectorBundle objects */\n      connectorStacks: null /* array of TreeLevelConnectorStackSize objects, \r\n                            it keeps total number of horizontal connectors lines between parents and children stack on top of each other */\n    },\n    _nullTreeLevelConnectorStackSize = new TreeLevelConnectorStackSize();\n  function process() {\n    var visualTree = visualTreeTask.getVisualTree();\n    _data.treeLevels = TreeLevels();\n    visualTree.loopLevels(this, function (treeItemId, treeItem, levelIndex) {\n      _data.treeLevels.addItem(levelIndex, treeItemId, treeItem);\n    });\n    _data.bundles = [];\n    _data.connectorStacks = [];\n    recalcLevelsDepth(_data.bundles, _data.connectorStacks, _data.treeLevels, visualTree);\n    return true;\n  }\n  function recalcLevelsDepth(bundles, connectorStacks, treeLevels, orgTree, orgPartners) {\n    var index,\n      len,\n      index2,\n      len2,\n      index3,\n      len3,\n      treeItem,\n      itemPosition,\n      bundle,\n      bundlesToStack,\n      bundlesByItemId = {},\n      startIndex,\n      endIndex,\n      stackSegments;\n    treeLevels.loopLevels(this, function (levelIndex, treeLevel) {\n      var stacksSizes = new TreeLevelConnectorStackSize();\n      connectorStacks[levelIndex] = stacksSizes;\n      bundlesToStack = [];\n      treeLevels.loopLevelItems(this, levelIndex, function (itemid, treeItem, position) {\n        var parents = [];\n        if (!bundlesByItemId.hasOwnProperty(itemid)) {\n          if (treeItem.connectorPlacement & SideFlag.Bottom) {\n            parents.push(itemid);\n          }\n          parents = parents.concat(treeItem.partners);\n          if (parents.length > 0) {\n            bundle = new VerticalConnectorBundle(parents, []);\n            for (var index = 0, len = parents.length; index < len; index += 1) {\n              bundlesByItemId[parents[index]] = bundle;\n            }\n            orgTree.loopChildren(this, itemid, function (childid, child, index) {\n              if (child.connectorPlacement & SideFlag.Top) {\n                bundle.toItems.push(childid);\n              }\n            }); //ignore jslint\n\n            if (parents.length > 1) {\n              bundlesToStack.push(bundle);\n            }\n            if (bundle.fromItems.length > 1 || bundle.toItems.length > 0) {\n              bundles.push(bundle);\n            }\n          }\n        }\n        if (treeItem.connectorPlacement & SideFlag.Left) {\n          bundle = new HorizontalConnectorBundle(itemid, treeLevels.getPrevItem(itemid));\n          bundles.push(bundle);\n        }\n        if (treeItem.connectorPlacement & SideFlag.Right) {\n          bundle = new HorizontalConnectorBundle(itemid, treeLevels.getNextItem(itemid));\n          bundles.push(bundle);\n        }\n      });\n      if (bundlesToStack.length > 0) {\n        /* find minimum and maximum partner index at level */\n        stackSegments = Pile();\n        for (index2 = 0, len2 = bundlesToStack.length; index2 < len2; index2 += 1) {\n          bundle = bundlesToStack[index2];\n          startIndex = null;\n          endIndex = null;\n          for (index3 = 0, len3 = bundle.fromItems.length; index3 < len3; index3 += 1) {\n            itemPosition = treeLevels.getItemPosition(bundle.fromItems[index3]);\n            startIndex = startIndex != null ? Math.min(startIndex, itemPosition) : itemPosition;\n            endIndex = endIndex != null ? Math.max(endIndex, itemPosition) : itemPosition;\n          }\n          stackSegments.add(startIndex, endIndex, bundle);\n        }\n        stacksSizes.parentsStackSize = stackSegments.resolve(this, function (from, to, bundle, offset, stackSize) {\n          bundle.fromOffset = offset + 1;\n          bundle.fromStackSize = stackSize;\n        }); //ignore jslint\n      }\n    });\n  }\n  function getTreeLevels() {\n    return _data.treeLevels;\n  }\n  function getBundles() {\n    return _data.bundles;\n  }\n  function getNestedLayoutParentConnectorIds() {\n    return {}; /* org chart does not support nested layouts */\n  }\n  function getNestedLayoutBottomConnectorIds() {\n    return {}; /* org chart does not support nested layouts */\n  }\n  function getConnectorsStacksSizes(levelid) {\n    return _data.connectorStacks[levelid] || _nullTreeLevelConnectorStackSize;\n  }\n  return {\n    process: process,\n    getTreeLevels: getTreeLevels,\n    getBundles: getBundles,\n    getConnectorsStacksSizes: getConnectorsStacksSizes,\n    getNestedLayoutParentConnectorIds: getNestedLayoutParentConnectorIds,\n    getNestedLayoutBottomConnectorIds: getNestedLayoutBottomConnectorIds\n  };\n}\n;","map":{"version":3,"names":["TreeLevelConnectorStackSize","TreeLevels","Pile","SideFlag","VerticalConnectorBundle","HorizontalConnectorBundle","VisualTreeLevelsTask","visualTreeTask","itemTemplateParamsTask","_data","treeLevels","bundles","connectorStacks","_nullTreeLevelConnectorStackSize","process","visualTree","getVisualTree","loopLevels","treeItemId","treeItem","levelIndex","addItem","recalcLevelsDepth","orgTree","orgPartners","index","len","index2","len2","index3","len3","itemPosition","bundle","bundlesToStack","bundlesByItemId","startIndex","endIndex","stackSegments","treeLevel","stacksSizes","loopLevelItems","itemid","position","parents","hasOwnProperty","connectorPlacement","Bottom","push","concat","partners","length","loopChildren","childid","child","Top","toItems","fromItems","Left","getPrevItem","Right","getNextItem","getItemPosition","Math","min","max","add","parentsStackSize","resolve","from","to","offset","stackSize","fromOffset","fromStackSize","getTreeLevels","getBundles","getNestedLayoutParentConnectorIds","getNestedLayoutBottomConnectorIds","getConnectorsStacksSizes","levelid"],"sources":["C:/Users/LCGI_15/Desktop/projects/nesty-orgchart/orgchart/node_modules/basicprimitives/src/tasks/transformations/VisualTreeLevelsTask.js"],"sourcesContent":["import TreeLevelConnectorStackSize from '../../models/TreeLevelConnectorStackSize';\r\nimport TreeLevels from '../../algorithms/TreeLevels';\r\nimport Pile from '../../algorithms/Pile';\r\nimport { SideFlag } from '../../enums';\r\nimport VerticalConnectorBundle from '../../connectors/VerticalConnectorBundle';\r\nimport HorizontalConnectorBundle from '../../connectors/HorizontalConnectorBundle';\r\n\r\n/* Read visual tree\r\n    populate treeLevels array of type TreeLevel\r\n      TreeLevel object contains ordered list of all its items \r\n      plus when items added to that collection we store level in item\r\n*/\r\nexport default function VisualTreeLevelsTask(visualTreeTask, itemTemplateParamsTask) {\r\n  var _data = {\r\n    treeLevels: null, /* TreeLevels */\r\n    bundles: null, /* array of BaseConnectorBundle objects */\r\n    connectorStacks: null /* array of TreeLevelConnectorStackSize objects, \r\n      it keeps total number of horizontal connectors lines between parents and children stack on top of each other */\r\n  },\r\n    _nullTreeLevelConnectorStackSize = new TreeLevelConnectorStackSize();\r\n\r\n  function process() {\r\n    var visualTree = visualTreeTask.getVisualTree();\r\n\r\n    _data.treeLevels = TreeLevels();\r\n\r\n    visualTree.loopLevels(this, function (treeItemId, treeItem, levelIndex) {\r\n      _data.treeLevels.addItem(levelIndex, treeItemId, treeItem);\r\n    });\r\n\r\n    _data.bundles = [];\r\n    _data.connectorStacks = [];\r\n\r\n    recalcLevelsDepth(_data.bundles, _data.connectorStacks, _data.treeLevels, visualTree);\r\n\r\n    return true;\r\n  }\r\n\r\n  function recalcLevelsDepth(bundles, connectorStacks, treeLevels, orgTree, orgPartners) {\r\n    var index, len,\r\n      index2, len2,\r\n      index3, len3,\r\n      treeItem,\r\n      itemPosition,\r\n      bundle, bundlesToStack, bundlesByItemId = {},\r\n      startIndex, endIndex, stackSegments;\r\n\r\n\r\n    treeLevels.loopLevels(this, function (levelIndex, treeLevel) {\r\n      var stacksSizes = new TreeLevelConnectorStackSize();\r\n      connectorStacks[levelIndex] = stacksSizes;\r\n\r\n      bundlesToStack = [];\r\n\r\n      treeLevels.loopLevelItems(this, levelIndex, function (itemid, treeItem, position) {\r\n        var parents = [];\r\n        if (!bundlesByItemId.hasOwnProperty(itemid)) {\r\n          if (treeItem.connectorPlacement & SideFlag.Bottom) {\r\n            parents.push(itemid);\r\n          }\r\n          parents = parents.concat(treeItem.partners);\r\n\r\n          if (parents.length > 0) {\r\n            bundle = new VerticalConnectorBundle(parents, []);\r\n\r\n            for (var index = 0, len = parents.length; index < len; index += 1) {\r\n              bundlesByItemId[parents[index]] = bundle;\r\n            }\r\n\r\n            orgTree.loopChildren(this, itemid, function (childid, child, index) {\r\n              if (child.connectorPlacement & SideFlag.Top) {\r\n                bundle.toItems.push(childid);\r\n              }\r\n            }); //ignore jslint\r\n\r\n            if (parents.length > 1) {\r\n              bundlesToStack.push(bundle);\r\n            }\r\n\r\n            if (bundle.fromItems.length > 1 || bundle.toItems.length > 0) {\r\n              bundles.push(bundle);\r\n            }\r\n          }\r\n        }\r\n\r\n        if (treeItem.connectorPlacement & SideFlag.Left) {\r\n          bundle = new HorizontalConnectorBundle(itemid, treeLevels.getPrevItem(itemid));\r\n          bundles.push(bundle);\r\n        }\r\n\r\n        if (treeItem.connectorPlacement & SideFlag.Right) {\r\n          bundle = new HorizontalConnectorBundle(itemid, treeLevels.getNextItem(itemid));\r\n          bundles.push(bundle);\r\n        }\r\n      });\r\n\r\n      if (bundlesToStack.length > 0) {\r\n        /* find minimum and maximum partner index at level */\r\n        stackSegments = Pile();\r\n        for (index2 = 0, len2 = bundlesToStack.length; index2 < len2; index2 += 1) {\r\n          bundle = bundlesToStack[index2];\r\n\r\n          startIndex = null;\r\n          endIndex = null;\r\n          for (index3 = 0, len3 = bundle.fromItems.length; index3 < len3; index3 += 1) {\r\n            itemPosition = treeLevels.getItemPosition(bundle.fromItems[index3]);\r\n\r\n            startIndex = (startIndex != null) ? Math.min(startIndex, itemPosition) : itemPosition;\r\n            endIndex = (endIndex != null) ? Math.max(endIndex, itemPosition) : itemPosition;\r\n          }\r\n          stackSegments.add(startIndex, endIndex, bundle);\r\n        }\r\n\r\n        stacksSizes.parentsStackSize = stackSegments.resolve(this, function (from, to, bundle, offset, stackSize) {\r\n          bundle.fromOffset = offset + 1;\r\n          bundle.fromStackSize = stackSize;\r\n        });//ignore jslint\r\n      }\r\n    });\r\n  }\r\n\r\n  function getTreeLevels() {\r\n    return _data.treeLevels;\r\n  }\r\n\r\n  function getBundles() {\r\n    return _data.bundles;\r\n  }\r\n\r\n  function getNestedLayoutParentConnectorIds() {\r\n    return {}; /* org chart does not support nested layouts */\r\n  }\r\n\r\n  function getNestedLayoutBottomConnectorIds() {\r\n    return {}; /* org chart does not support nested layouts */\r\n  }\r\n\r\n  function getConnectorsStacksSizes(levelid) {\r\n    return _data.connectorStacks[levelid] || _nullTreeLevelConnectorStackSize;\r\n  }\r\n\r\n  return {\r\n    process: process,\r\n    getTreeLevels: getTreeLevels,\r\n    getBundles: getBundles,\r\n    getConnectorsStacksSizes: getConnectorsStacksSizes,\r\n    getNestedLayoutParentConnectorIds: getNestedLayoutParentConnectorIds,\r\n    getNestedLayoutBottomConnectorIds: getNestedLayoutBottomConnectorIds\r\n  };\r\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}