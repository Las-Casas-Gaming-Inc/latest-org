{"ast":null,"code":"import Tree from '../../../algorithms/Tree';\nimport { SideFlag, Visibility, HorizontalAlignmentType, AdviserPlacementType, Enabled, ChildrenPlacementType, ItemType } from '../../../enums';\nimport TreeItem from '../../../models/TreeItem';\nimport { RowType, GroupType } from './enums';\nimport NodeTypeSorter from './NodeTypeSorter';\nimport NodeGroupSorter from './NodeGroupSorter';\nimport BranchAligner from './BranchAligner';\nimport NavigationalFamily from './NavigationalFamily';\nfunction NodeProps() {\n  this.hasVisibleChildren = false;\n  this.hasPartners = false;\n  this.isPartner = false;\n  this.hasLeavesOnly = true;\n  this.hasChildren = false;\n  this.typeSorter = NodeTypeSorter();\n  this.groupSorter = NodeGroupSorter();\n}\n\n/* method uses structures created in orgTreeTask to create visual tree used to render chart\r\n  It populates visualTree structure with TreeItem objects.\r\n*/\nexport default function VisualTreeBuilder() {\n  var _treeItemCounter, _activeItems;\n  function build(orgTree, maximumId, activeItems, options) {\n    _treeItemCounter = maximumId;\n    _activeItems = activeItems;\n    var {\n      visualTree,\n      navigationFamily,\n      branchAligner\n    } = createVisualTreeItems(orgTree, options, activeItems);\n    return {\n      visualTree: visualTree,\n      navigationFamily: navigationFamily.getFamily(),\n      branchAligner: branchAligner,\n      treeItemCounter: _treeItemCounter\n    };\n  }\n  function createVisualTreeItems(orgTree, options, activeItems) {\n    var index,\n      leftSiblingOffset,\n      rightSiblingOffset,\n      orgTreeProps = {},\n      visualTree = Tree(),\n      /* Tree(); key: TreeItem.id value: TreeItem */\n      navigationFamily = NavigationalFamily(activeItems); /* Family structure where key: TreeItem.id and value: TreeItem */\n\n    /* stage 1: orgTreeProps hash, find and set actualItemType, hasPartners, hasVisibleChildren, hasLeavesOnly */\n    orgTree.loopPostOrder(this, function (nodeId, node, parentId, parent) {\n      if (!orgTreeProps.hasOwnProperty(nodeId)) {\n        orgTreeProps[nodeId] = new NodeProps();\n      }\n      var nodeProps = orgTreeProps[nodeId];\n      nodeProps.actualItemType = node.itemType;\n      if (parent != null) {\n        if (!orgTreeProps.hasOwnProperty(parentId)) {\n          orgTreeProps[parentId] = new NodeProps();\n        }\n        var parentProps = orgTreeProps[parentId];\n        parentProps.hasVisibleChildren = parentProps.hasVisibleChildren || node.isVisible || nodeProps.hasVisibleChildren;\n        parentProps.hasChildren = true;\n        parentProps.hasLeavesOnly = parentProps.hasLeavesOnly && !nodeProps.hasChildren;\n      }\n    });\n\n    /* stage 2: convert not supported combinations of child and parent items */\n    orgTree.loopPreOrder(this, function (nodeId, node, parentId, parent) {\n      var nodeProps = orgTreeProps[nodeId];\n      var parentProps = orgTreeProps[parentId];\n      if (!parentProps) {\n        parentProps = new NodeProps();\n        parentProps.actualItemType = ItemType.Regular;\n        orgTreeProps[parentId] = parentProps;\n      }\n      switch (nodeProps.actualItemType) {\n        case ItemType.LimitedPartner:\n        case ItemType.AdviserPartner:\n        case ItemType.GeneralPartner:\n          /* Don't support partner of partner */\n          if (parentProps.isPartner) {\n            nodeProps.actualItemType = ItemType.Adviser;\n          } else {\n            nodeProps.isPartner = true;\n            parentProps.hasPartners = true;\n          }\n          break;\n        case ItemType.Regular:\n          /* Don't support regular children of partner */\n          if (parentProps.isPartner) {\n            nodeProps.actualItemType = ItemType.Assistant;\n          }\n          break;\n      }\n    });\n\n    /* stage 3: find nodes alignment levels, so nodes from different branches of the hierarchy will be placed at the same level */\n    var branchAligner = BranchAligner();\n    orgTree.loopLevels(this, function (parentOrgItemId, parentOrgItem, levelid) {\n      var parentProps = orgTreeProps[parentOrgItemId];\n      if (!parentProps.hasVisibleChildren) {\n        return orgTree.SKIP;\n      }\n      orgTree.loopChildren(this, parentOrgItemId, function (orgItemId, orgItem, index) {\n        var treeItemProps = orgTreeProps[orgItemId];\n        parentProps.typeSorter.addChild(treeItemProps.actualItemType, orgItem.levelOffset, orgItem);\n        parentProps.groupSorter.addChild(treeItemProps.actualItemType, orgItem.levelOffset, orgItem);\n      });\n      var partners = [];\n      if (parentProps.hasPartners) {\n        partners = [...parentProps.typeSorter.getRow(ItemType.AdviserPartner), ...parentProps.typeSorter.getRow(ItemType.LimitedPartner), ...parentProps.typeSorter.getRow(ItemType.GeneralPartner)];\n      }\n      var advisers = parentProps.typeSorter.getRow(ItemType.Adviser);\n      if (advisers.length > 0) {\n        /* extend advisers level */\n        var extendChildren = partners.length > 0;\n        if (!extendChildren) {\n          switch (parentOrgItem.placeAdvisersAboveChildren) {\n            case Enabled.Auto:\n              extendChildren = options.placeAdvisersAboveChildren;\n              break;\n            case Enabled.True:\n              extendChildren = true;\n              break;\n          }\n        }\n        if (options.alignBranches) {\n          if (parentProps.isPartner) {\n            extendChildren = true;\n          }\n          if (extendChildren) {\n            branchAligner.mergeToChild(parentOrgItemId, advisers, RowType.Advisers, 0, 0, extendChildren);\n          } else {\n            branchAligner.mergeToParent(parentOrgItemId, advisers);\n          }\n        } else {\n          branchAligner.addChild(parentOrgItemId, advisers, RowType.Advisers, 0, 0, extendChildren);\n        }\n      }\n      var subAdvisers = parentProps.typeSorter.getRow(ItemType.SubAdviser);\n      if (subAdvisers.length > 0) {\n        /* extend advisers level */\n        var extendChildren = partners.length > 0;\n        if (!extendChildren) {\n          switch (parentOrgItem.placeAdvisersAboveChildren) {\n            case Enabled.Auto:\n              extendChildren = options.placeAdvisersAboveChildren;\n              break;\n            case Enabled.True:\n              extendChildren = true;\n              break;\n          }\n        }\n        if (options.alignBranches) {\n          if (parentProps.isPartner) {\n            extendChildren = true;\n          }\n          branchAligner.mergeToChild(parentOrgItemId, subAdvisers, RowType.SubAdvisers, 0, 1, extendChildren);\n        } else {\n          branchAligner.addChild(parentOrgItemId, subAdvisers, RowType.SubAdvisers, 0, 1, extendChildren);\n        }\n      }\n      var assistants = parentProps.typeSorter.getRows(ItemType.Assistant);\n      /* create assistants levels */\n      if (assistants.length > 0) {\n        /* extend assistants levels */\n        var extendChildren = partners.length > 0;\n        if (!extendChildren) {\n          switch (parentOrgItem.placeAssistantsAboveChildren) {\n            case Enabled.Auto:\n              extendChildren = options.placeAssistantsAboveChildren;\n              break;\n            case Enabled.True:\n              extendChildren = true;\n              break;\n          }\n        }\n        assistants.forEach((nodes, index) => {\n          if (options.alignBranches) {\n            branchAligner.mergeToChild(parentOrgItemId, nodes, RowType.Assistants, index, 0, extendChildren);\n          } else {\n            branchAligner.addChild(parentOrgItemId, nodes, RowType.Assistants, index, 0, extendChildren);\n          }\n        });\n      }\n      var subAssistants = parentProps.typeSorter.getRows(ItemType.SubAssistant);\n      /* create assistants levels */\n      if (subAssistants.length > 0) {\n        /* extend assistants levels */\n        var extendChildren = partners.length > 0;\n        if (!extendChildren) {\n          switch (parentOrgItem.placeAssistantsAboveChildren) {\n            case Enabled.Auto:\n              extendChildren = options.placeAssistantsAboveChildren;\n              break;\n            case Enabled.True:\n              extendChildren = true;\n              break;\n          }\n        }\n        subAssistants.forEach((nodes, index) => {\n          if (options.alignBranches) {\n            branchAligner.mergeToChild(parentOrgItemId, nodes, RowType.SubAssistants, index, 1, extendChildren);\n          } else {\n            branchAligner.addChild(parentOrgItemId, nodes, RowType.SubAssistants, index, 1, extendChildren);\n          }\n        });\n      }\n      if (partners.length > 0) {\n        branchAligner.mergeToParent(parentOrgItemId, partners);\n      }\n      var rowChildren = parentProps.groupSorter.getRows(GroupType.RowChildren);\n      /* create row children levels */\n      if (rowChildren.length > 0) {\n        rowChildren.forEach((nodes, index) => {\n          if (options.alignBranches) {\n            branchAligner.mergeToChild(parentOrgItemId, nodes, RowType.RowChildren, index, 0, true);\n          } else {\n            branchAligner.addChild(parentOrgItemId, nodes, RowType.RowChildren, index, 0, true);\n          }\n        });\n      }\n\n      /* add remaining children in formation */\n      var children = parentProps.groupSorter.getRow(GroupType.Children);\n      if (children.length > 0) {\n        var props = orgTreeProps[parentOrgItemId];\n        var childrenRows = getRegularChildrenRows(options, children, parentOrgItem.childrenPlacementType, props.hasLeavesOnly);\n        childrenRows.forEach((nodes, index) => {\n          if (options.alignBranches) {\n            branchAligner.mergeToChild(parentOrgItemId, nodes, RowType.Children, index, 0, true);\n          } else {\n            if (index == childrenRows.length - 1) {\n              branchAligner.addSplitChildren(parentOrgItemId, nodes, RowType.Children, index, 0);\n            } else {\n              branchAligner.addChild(parentOrgItemId, nodes, RowType.Children, index, 0, true);\n            }\n          }\n        });\n      }\n    });\n\n    /* stage 4: measure depth of alignment levels */\n    branchAligner.align();\n\n    /* stage 5: create visual tree */\n    var visualPartners = {};\n    orgTree.loopLevels(this, function (parentOrgItemId, parentOrgItem, levelid) {\n      var parentProps = orgTreeProps[parentOrgItemId];\n      var logicalParentItem = visualTree.node(parentOrgItemId);\n      if (!logicalParentItem) {\n        logicalParentItem = getNewTreeItem({\n          visibility: Visibility.Invisible,\n          connectorPlacement: 0,\n          parentId: null,\n          actualItemType: ItemType.Regular\n        }, parentOrgItem);\n        visualTree.add(null, parentOrgItemId, logicalParentItem);\n      }\n\n      /* find left and right siblings margins of logical parent item\r\n        they are needed to properly place GeneralPartner & LimitedPartner nodes. */\n      leftSiblingOffset = 0;\n      rightSiblingOffset = 0;\n      if ((index = visualTree.indexOf(parentOrgItemId)) != null) {\n        leftSiblingOffset = index;\n        rightSiblingOffset = visualTree.countSiblings(parentOrgItemId) - index - 1;\n      }\n      var partners = [];\n      if (parentProps.hasPartners) {\n        partners = [...parentProps.typeSorter.getRow(ItemType.AdviserPartner), ...parentProps.typeSorter.getRow(ItemType.LimitedPartner), ...parentProps.typeSorter.getRow(ItemType.GeneralPartner)];\n      }\n      var visualParent = logicalParentItem;\n      var visualParent2 = null;\n      var flagPartners = true;\n      branchAligner.loopGroupTypes(this, parentOrgItemId, function (groupType, len) {\n        if (!(parentProps.hasPartners || parentProps.isPartner) && groupType > parentProps.groupSorter.getLength() - 1) {\n          return true;\n        }\n        if (groupType > GroupType.Assistants && flagPartners) {\n          flagPartners = false;\n          if (parentProps.hasPartners) {\n            visualPartners[parentOrgItemId] = [visualParent.id];\n            visualParent = visualParent2 || visualParent;\n            visualParent2 = null;\n            visualParent.partners = visualPartners[parentOrgItemId];\n          }\n          if (parentProps.isPartner) {\n            visualPartners[parentOrgItem.parent].push(visualParent.id);\n          }\n        }\n        var fillEmptyLevels = (parentProps.isPartner || parentProps.hasPartners) && groupType <= GroupType.Assistants;\n        fillEmptyLevels = fillEmptyLevels || groupType < parentProps.groupSorter.getLength() - 1;\n        var rows = [];\n        switch (groupType) {\n          case GroupType.Items:\n            var row = parentProps.groupSorter.getRows(GroupType.Items)[0] || [];\n            var depth = branchAligner.getRowDepth(parentOrgItemId, GroupType.Items, 0);\n            addAdvisers(visualTree, orgTreeProps, visualParent, row, leftSiblingOffset, rightSiblingOffset);\n            row.forEach(item => navigationFamily.define(parentOrgItem, item));\n            if (partners.length > 0) {\n              visualParent2 = addPartners(visualTree, orgTreeProps, visualParent, partners, leftSiblingOffset, rightSiblingOffset);\n              /* every child logically belongs to every partner */\n              partners.forEach(partner => {\n                navigationFamily.define(parentOrgItem, partner, true);\n                if (partner.id != logicalParentItem.id) {\n                  var rowChildren = parentProps.groupSorter.getRows(GroupType.RowChildren);\n                  rowChildren.forEach(row => row.forEach(child => navigationFamily.define(partner, child)));\n                  var regularChildren = parentProps.groupSorter.getRow(GroupType.Children);\n                  regularChildren.forEach(child => navigationFamily.define(partner, child));\n                }\n              });\n            }\n            if (parentProps.hasPartners || parentProps.isPartner || groupType < parentProps.groupSorter.getLength() - 1) {\n              while (depth > 1) {\n                visualParent = createNewVisualAggregator(visualTree, visualParent, false);\n                if (visualParent2) {\n                  visualParent2 = createNewVisualAggregator(visualTree, visualParent2, false);\n                }\n                depth -= 1;\n              }\n            }\n            break;\n          case GroupType.Assistants:\n            var rows = parentProps.groupSorter.getRows(GroupType.Assistants);\n            branchAligner.loopRows(this, parentOrgItemId, RowType.Assistants, function (depth, rowIndex) {\n              var row = rows[rowIndex] || [];\n              if (!fillEmptyLevels && rowIndex > rows.length - 1) {\n                return true;\n              }\n              visualParent = addAssistants(visualTree, orgTreeProps, visualParent, row);\n              if (visualParent2) {\n                visualParent2 = createNewVisualAggregator(visualTree, visualParent2, false);\n              }\n              row.forEach(item => navigationFamily.define(parentOrgItem, item));\n              if (parentProps.hasPartners || parentProps.isPartner || rowIndex < rows.length - 1 || groupType < parentProps.groupSorter.getLength() - 1) {\n                while (depth > 1) {\n                  visualParent = createNewVisualAggregator(visualTree, visualParent, false);\n                  if (visualParent2) {\n                    visualParent2 = createNewVisualAggregator(visualTree, visualParent2, false);\n                  }\n                  depth -= 1;\n                }\n              }\n            });\n            break;\n          case GroupType.RowChildren:\n            var rows = parentProps.groupSorter.getRows(GroupType.RowChildren);\n            branchAligner.loopRows(this, parentOrgItemId, RowType.RowChildren, function (depth, rowIndex) {\n              var row = rows[rowIndex] || [];\n              if (!fillEmptyLevels && rowIndex > rows.length - 1) {\n                return true;\n              }\n              var hideChildConnector = logicalParentItem.visibility == Visibility.Invisible && logicalParentItem.connectorPlacement === 0;\n              visualParent = addRowChildren(visualTree, visualParent, row, fillEmptyLevels || rowIndex < rows.length - 1, hideChildConnector, options.horizontalAlignment);\n              row.forEach(item => navigationFamily.define(parentOrgItem, item));\n              if (rowIndex < rows.length - 1 || groupType < parentProps.groupSorter.getLength() - 1) {\n                while (depth > 1) {\n                  visualParent = createNewVisualAggregator(visualTree, visualParent, false);\n                  depth -= 1;\n                }\n              }\n            });\n            break;\n          case GroupType.Children:\n            var regularChildren = parentProps.groupSorter.getRow(GroupType.Children); /* children added after all other custom item types */\n            /* add remaining children in formation */\n            if (regularChildren.length > 0) {\n              var props = orgTreeProps[logicalParentItem.id];\n              var depths = branchAligner.getRowsDepth(parentOrgItemId, GroupType.Children);\n              addChildren(orgTree, visualTree, depths, options, logicalParentItem, visualParent, regularChildren, parentOrgItem.childrenPlacementType, props.hasLeavesOnly);\n              regularChildren.forEach(item => navigationFamily.define(parentOrgItem, item));\n            }\n            break;\n        }\n      });\n      if (flagPartners) {\n        flagPartners = false;\n        if (parentProps.hasPartners) {\n          visualPartners[parentOrgItemId] = [visualParent.id];\n          visualParent = visualParent2 || visualParent;\n          visualParent2 = null;\n          visualParent.partners = visualPartners[parentOrgItemId];\n        }\n        if (parentProps.isPartner) {\n          visualPartners[parentOrgItem.parent].push(visualParent.id);\n        }\n      }\n      if (!parentProps.hasVisibleChildren) {\n        return orgTree.SKIP;\n      }\n    });\n    return {\n      visualTree: visualTree,\n      navigationFamily: navigationFamily,\n      branchAligner: branchAligner\n    };\n  }\n  function addPartners(visualTree, orgTreeProps, parent, partners, leftSiblingOffset, rightSiblingOffset) {\n    var leftItems = [];\n    var rightItems = [];\n    partners.map(partner => getNewTreeItem({}, partner)).forEach(item => {\n      var isLeft = true;\n      if (parent.connectorPlacement & SideFlag.Right) {\n        isLeft = true;\n        item.connectorPlacement = SideFlag.Right | SideFlag.Bottom;\n      } else if (parent.connectorPlacement & SideFlag.Left) {\n        isLeft = false;\n        item.connectorPlacement = SideFlag.Left | SideFlag.Bottom;\n      } else {\n        switch (item.adviserPlacementType) {\n          case AdviserPlacementType.Left:\n            isLeft = true;\n            item.connectorPlacement = SideFlag.Right | SideFlag.Bottom;\n            break;\n          default:\n            isLeft = false;\n            item.connectorPlacement = SideFlag.Left | SideFlag.Bottom;\n            break;\n        }\n        var itemProp = orgTreeProps[item.id];\n        switch (itemProp.actualItemType) {\n          case ItemType.GeneralPartner:\n            item.connectorPlacement = SideFlag.Top | SideFlag.Bottom;\n            break;\n          case ItemType.LimitedPartner:\n            item.connectorPlacement = SideFlag.Bottom;\n            break;\n          default:\n            break;\n        }\n      }\n      if (isLeft) {\n        leftItems.unshift(item);\n      } else {\n        rightItems.push(item);\n      }\n    });\n    var partners = [...leftItems, parent, ...rightItems];\n    var parentIndex = leftItems.length;\n    var centerIndex = Math.floor(partners.length / 2);\n    var invisiblePartner = null;\n    if (partners.length % 2 == 0) {\n      invisiblePartner = getNewTreeItem({\n        visibility: Visibility.Invisible\n      });\n      partners.splice(centerIndex, 0, invisiblePartner);\n      if (centerIndex <= parentIndex) {\n        parentIndex += 1;\n      }\n    }\n    var visualParent = visualTree.parent(parent.id);\n    for (var index = parentIndex - 1; index >= 0; index -= 1) {\n      var item = partners[index];\n      visualTree.add(visualParent.id, item.id, item, leftSiblingOffset);\n      item.gravity = HorizontalAlignmentType.Right;\n    }\n    for (var index = parentIndex + 1; index < partners.length; index += 1) {\n      var item = partners[index];\n      visualTree.add(visualParent.id, item.id, item, visualTree.countChildren(visualParent.id) - rightSiblingOffset);\n      item.gravity = HorizontalAlignmentType.Left;\n    }\n    if (invisiblePartner != null) {\n      var mimicPartner = null;\n      if (centerIndex <= parentIndex) {\n        mimicPartner = partners[centerIndex - 1];\n      } else {\n        mimicPartner = partners[centerIndex + 1];\n      }\n      invisiblePartner.connectorPlacement = mimicPartner.connectorPlacement & (SideFlag.Left | SideFlag.Right);\n    }\n    var centerPartner = partners[centerIndex];\n    return centerPartner;\n  }\n  function addAdvisers(visualTree, orgTreeProps, parent, advisers, leftSiblingOffset, rightSiblingOffset) {\n    advisers.map(adviser => getNewTreeItem({}, adviser)).forEach(item => {\n      var itemProps = orgTreeProps[item.id];\n      var alteredItem;\n      switch (itemProps.actualItemType) {\n        case ItemType.SubAdviser:\n          item.connectorPlacement = SideFlag.Top | SideFlag.Bottom;\n          alteredItem = getNewTreeItem({\n            visibility: Visibility.Invisible\n          });\n          visualTree.add(alteredItem.id, item.id, item);\n          break;\n        default:\n          alteredItem = item;\n          break;\n      }\n      var visualParent = visualTree.parent(parent.id);\n      if (parent.connectorPlacement & SideFlag.Right) {\n        visualTree.add(visualParent.id, alteredItem.id, alteredItem, leftSiblingOffset);\n        alteredItem.connectorPlacement = SideFlag.Right | SideFlag.Bottom;\n        alteredItem.gravity = HorizontalAlignmentType.Right;\n      } else if (parent.connectorPlacement & SideFlag.Left) {\n        visualTree.add(visualParent.id, alteredItem.id, alteredItem, visualTree.countChildren(visualParent.id) - rightSiblingOffset);\n        alteredItem.connectorPlacement = SideFlag.Left | SideFlag.Bottom;\n        alteredItem.gravity = HorizontalAlignmentType.Left;\n      } else {\n        switch (item.adviserPlacementType) {\n          case AdviserPlacementType.Left:\n            visualTree.add(visualParent.id, alteredItem.id, alteredItem, leftSiblingOffset);\n            alteredItem.connectorPlacement = SideFlag.Right | SideFlag.Bottom;\n            alteredItem.gravity = HorizontalAlignmentType.Right;\n            break;\n          default:\n            visualTree.add(visualParent.id, alteredItem.id, alteredItem, visualTree.countChildren(visualParent.id) - rightSiblingOffset);\n            alteredItem.connectorPlacement = SideFlag.Left | SideFlag.Bottom;\n            alteredItem.gravity = HorizontalAlignmentType.Left;\n            break;\n        }\n        switch (item.actualItemType) {\n          case ItemType.GeneralPartner:\n            alteredItem.connectorPlacement = SideFlag.Top | SideFlag.Bottom;\n            break;\n          case ItemType.LimitedPartner:\n            alteredItem.connectorPlacement = SideFlag.Bottom;\n            break;\n        }\n      }\n    });\n  }\n  function addAssistants(visualTree, orgTreeProps, visualParent, assistants) {\n    var nextVisualParent = createNewVisualAggregator(visualTree, visualParent, false);\n    assistants.map(assistant => getNewTreeItem({}, assistant)).forEach(item => {\n      var itemProps = orgTreeProps[item.id];\n      var alteredItem;\n      switch (itemProps.actualItemType) {\n        case ItemType.SubAssistant:\n          item.connectorPlacement = SideFlag.Top | SideFlag.Bottom;\n          alteredItem = getNewTreeItem({\n            visibility: Visibility.Invisible\n          });\n          visualTree.add(alteredItem.id, item.id, item);\n          break;\n        case ItemType.Assistant:\n          alteredItem = item;\n          break;\n      }\n      switch (item.adviserPlacementType) {\n        case AdviserPlacementType.Left:\n          visualTree.add(visualParent.id, alteredItem.id, alteredItem, 0);\n          alteredItem.connectorPlacement = SideFlag.Right | SideFlag.Bottom;\n          alteredItem.gravity = HorizontalAlignmentType.Right;\n          break;\n        default:\n          visualTree.add(visualParent.id, alteredItem.id, alteredItem);\n          alteredItem.connectorPlacement = SideFlag.Left | SideFlag.Bottom;\n          alteredItem.gravity = HorizontalAlignmentType.Left;\n          break;\n      }\n    });\n    return nextVisualParent;\n  }\n  function addRowChildren(visualTree, visualParent, rowOfChildren, fillEmptyLevels, hideChildConnector, horizontalAlignment) {\n    var nextVisualParent = null;\n    if (fillEmptyLevels) {\n      nextVisualParent = createNewVisualAggregator(visualTree, visualParent, hideChildConnector);\n    }\n    var medianIndex = 0;\n    switch (horizontalAlignment) {\n      case HorizontalAlignmentType.Center:\n        medianIndex = Math.ceil(rowOfChildren.length / 2) - 1;\n        break;\n      case HorizontalAlignmentType.Left:\n        medianIndex = -1;\n        break;\n      case HorizontalAlignmentType.Right:\n        medianIndex = rowOfChildren.length - 1;\n        break;\n    }\n    for (var index = medianIndex; index >= 0; index -= 1) {\n      var item = getNewTreeItem({}, rowOfChildren[index]);\n      visualTree.add(visualParent.id, item.id, item, 0);\n      item.connectorPlacement = SideFlag.Top | SideFlag.Bottom;\n      item.gravity = HorizontalAlignmentType.Right;\n    }\n    for (index = medianIndex + 1; index < rowOfChildren.length; index += 1) {\n      item = getNewTreeItem({}, rowOfChildren[index]);\n      visualTree.add(visualParent.id, item.id, item);\n      item.connectorPlacement = SideFlag.Top | SideFlag.Bottom;\n      item.gravity = HorizontalAlignmentType.Left;\n    }\n    return nextVisualParent;\n  }\n  function addChildren(orgTree, visualTree, depths, options, treeItem, visualParent, regularChildren, childrenPlacementType, hasLeavesOnly) {\n    var visualParent,\n      currentVisualParent,\n      leftChildItem,\n      rightChildItem,\n      newAggregatorItem,\n      childItem,\n      orgChildItem,\n      width,\n      height,\n      twinColumns,\n      rowIndex,\n      index,\n      len,\n      singleItemPlacement,\n      hideParentConnector = treeItem.visibility == Visibility.Invisible && treeItem.connectorPlacement === 0;\n    switch (options.horizontalAlignment) {\n      case HorizontalAlignmentType.Center:\n      case HorizontalAlignmentType.Left:\n        singleItemPlacement = AdviserPlacementType.Right;\n        break;\n      case HorizontalAlignmentType.Right:\n        singleItemPlacement = AdviserPlacementType.Left;\n        break;\n    }\n    if (childrenPlacementType === ChildrenPlacementType.Auto) {\n      if (hasLeavesOnly) {\n        childrenPlacementType = options.leavesPlacementType === ChildrenPlacementType.Auto ? ChildrenPlacementType.Matrix : options.leavesPlacementType;\n      } else {\n        childrenPlacementType = options.childrenPlacementType === ChildrenPlacementType.Auto ? ChildrenPlacementType.Horizontal : options.childrenPlacementType;\n      }\n    }\n    if (childrenPlacementType == ChildrenPlacementType.Matrix && regularChildren.length < 3) {\n      childrenPlacementType = ChildrenPlacementType.Horizontal;\n    }\n    switch (childrenPlacementType) {\n      case ChildrenPlacementType.Horizontal:\n        for (index = 0, len = regularChildren.length; index < len; index += 1) {\n          childItem = getNewTreeItem({}, regularChildren[index]);\n          orgChildItem = orgTree.node(childItem.id);\n          visualTree.add(visualParent.id, childItem.id, childItem);\n          childItem.connectorPlacement = (orgChildItem.hideParentConnection ? 0 : SideFlag.Top) | (orgChildItem.hideChildrenConnection ? 0 : SideFlag.Bottom);\n          if (index === 0) {\n            childItem.relationDegree = 1;\n          }\n        }\n        break;\n      case ChildrenPlacementType.Matrix:\n        width = Math.min(options.maximumColumnsInMatrix, Math.ceil(Math.sqrt(regularChildren.length)));\n        height = Math.ceil(regularChildren.length / width);\n        twinColumns = Math.ceil(width / 2.0);\n        for (var columnIndex = 0; columnIndex < twinColumns; columnIndex += 1) {\n          currentVisualParent = visualParent;\n          for (rowIndex = 0; rowIndex < height; rowIndex += 1) {\n            leftChildItem = getMatrixItem(regularChildren, columnIndex * 2, rowIndex, width);\n            rightChildItem = getMatrixItem(regularChildren, columnIndex * 2 + 1, rowIndex, width);\n            if (leftChildItem !== null || rightChildItem !== null) {\n              var depth = depths[rowIndex - 1] || 1;\n              while (depth > 1) {\n                newAggregatorItem = getNewTreeItem({\n                  visibility: Visibility.Invisible,\n                  connectorPlacement: hideParentConnector ? 0 : SideFlag.Top | SideFlag.Bottom\n                });\n                visualTree.add(currentVisualParent.id, newAggregatorItem.id, newAggregatorItem);\n                currentVisualParent = newAggregatorItem;\n                depth -= 1;\n              }\n            }\n            if (leftChildItem !== null) {\n              leftChildItem = getNewTreeItem({}, leftChildItem);\n              if (columnIndex === 0) {\n                leftChildItem.relationDegree = 1;\n              }\n              visualTree.add(currentVisualParent.id, leftChildItem.id, leftChildItem);\n              leftChildItem.connectorPlacement = (hideParentConnector ? 0 : SideFlag.Right) | SideFlag.Bottom;\n              leftChildItem.gravity = HorizontalAlignmentType.Right;\n            }\n            if (leftChildItem !== null || rightChildItem !== null) {\n              newAggregatorItem = getNewTreeItem({\n                visibility: Visibility.Invisible,\n                connectorPlacement: hideParentConnector ? 0 : SideFlag.Top | SideFlag.Bottom\n              });\n              visualTree.add(currentVisualParent.id, newAggregatorItem.id, newAggregatorItem);\n            }\n            if (rightChildItem !== null) {\n              rightChildItem = getNewTreeItem({}, rightChildItem);\n              visualTree.add(currentVisualParent.id, rightChildItem.id, rightChildItem);\n              rightChildItem.connectorPlacement = (hideParentConnector ? 0 : SideFlag.Left) | SideFlag.Bottom;\n              rightChildItem.gravity = HorizontalAlignmentType.Left;\n            }\n            currentVisualParent = newAggregatorItem;\n          }\n        }\n        if (width > 2) {\n          // No center alignment to aggregator required\n          visualParent.visualAggregatorId = null;\n        }\n        break;\n      case ChildrenPlacementType.Vertical:\n        for (index = 0, len = regularChildren.length; index < len; index += 1) {\n          childItem = getNewTreeItem({}, regularChildren[index]);\n          var depth = index == len - 1 ? 1 : depths[index] || 1;\n          var aggregatorItem = visualParent;\n          while (depth > 0) {\n            newAggregatorItem = getNewTreeItem({\n              visibility: Visibility.Invisible,\n              connectorPlacement: hideParentConnector ? 0 : SideFlag.Top | SideFlag.Bottom\n            });\n            visualTree.add(aggregatorItem.id, newAggregatorItem.id, newAggregatorItem);\n            aggregatorItem = newAggregatorItem;\n            depth -= 1;\n          }\n          switch (singleItemPlacement) {\n            case AdviserPlacementType.Left:\n              visualTree.add(visualParent.id, childItem.id, childItem, 0);\n              childItem.connectorPlacement = (hideParentConnector ? 0 : SideFlag.Right) | SideFlag.Bottom;\n              childItem.gravity = HorizontalAlignmentType.Right;\n              break;\n            case AdviserPlacementType.Right:\n              visualTree.add(visualParent.id, childItem.id, childItem);\n              childItem.connectorPlacement = (hideParentConnector ? 0 : SideFlag.Left) | SideFlag.Bottom;\n              childItem.gravity = HorizontalAlignmentType.Left;\n              break;\n          }\n          visualParent = newAggregatorItem;\n        }\n        break;\n      default:\n        throw \"Children placement is undefined!\";\n    }\n  }\n  function getRegularChildrenRows(options, regularChildren, childrenPlacementType, hasLeavesOnly) {\n    var results = [];\n    if (childrenPlacementType === ChildrenPlacementType.Auto) {\n      if (hasLeavesOnly) {\n        childrenPlacementType = options.leavesPlacementType === ChildrenPlacementType.Auto ? ChildrenPlacementType.Matrix : options.leavesPlacementType;\n      } else {\n        childrenPlacementType = options.childrenPlacementType === ChildrenPlacementType.Auto ? ChildrenPlacementType.Horizontal : options.childrenPlacementType;\n      }\n    }\n    if (childrenPlacementType == ChildrenPlacementType.Matrix && regularChildren.length < 3) {\n      childrenPlacementType = ChildrenPlacementType.Horizontal;\n    }\n    switch (childrenPlacementType) {\n      case ChildrenPlacementType.Horizontal:\n        results.push(regularChildren);\n        break;\n      case ChildrenPlacementType.Matrix:\n        var width = Math.min(options.maximumColumnsInMatrix, Math.ceil(Math.sqrt(regularChildren.length)));\n        for (var index = 0; index < regularChildren.length; index += width) {\n          results.push(regularChildren.slice(index, index + width));\n        }\n        break;\n      case ChildrenPlacementType.Vertical:\n        regularChildren.forEach(childItem => {\n          results.push([childItem]);\n        });\n        break;\n    }\n    return results;\n  }\n  function getMatrixItem(items, x, y, width) {\n    var result,\n      isOdd = width % 2 > 0,\n      index;\n    if (isOdd) {\n      if (x === width - 1) {\n        x = items.length;\n      } else if (x === width) {\n        x = width - 1;\n      }\n    }\n    index = y * width + x;\n    result = index > items.length - 1 ? null : items[index];\n    return result;\n  }\n  function createNewVisualAggregator(visualTree, treeItem, hideChildrenConnector) {\n    var newAggregatorItem,\n      hideParentConnector = treeItem.visibility == Visibility.Invisible && (treeItem.connectorPlacement & SideFlag.Top) === 0 || hideChildrenConnector;\n    newAggregatorItem = getNewTreeItem({\n      visibility: Visibility.Invisible,\n      visualAggregatorId: treeItem.visualAggregatorId,\n      connectorPlacement: hideParentConnector ? 0 : SideFlag.Top | SideFlag.Bottom\n    });\n    visualTree.insert(treeItem.id, newAggregatorItem.id, newAggregatorItem);\n    treeItem.visualAggregatorId = newAggregatorItem.id;\n    return newAggregatorItem;\n  }\n  function getNewTreeItem(properties, orgItem) {\n    var result = new TreeItem(),\n      optionKey;\n    if (orgItem != null) {\n      result.actualItemType = orgItem.itemType;\n      result.adviserPlacementType = orgItem.adviserPlacementType;\n    }\n    for (optionKey in properties) {\n      if (properties.hasOwnProperty(optionKey)) {\n        result[optionKey] = properties[optionKey];\n      }\n    }\n    if (orgItem != null) {\n      result.id = orgItem.id;\n      result.visibility = orgItem.isVisible ? Visibility.Auto : Visibility.Invisible;\n    } else {\n      _treeItemCounter += 1;\n      result.id = _treeItemCounter;\n    }\n    return result;\n  }\n  return {\n    build: build\n  };\n}\n;","map":{"version":3,"names":["Tree","SideFlag","Visibility","HorizontalAlignmentType","AdviserPlacementType","Enabled","ChildrenPlacementType","ItemType","TreeItem","RowType","GroupType","NodeTypeSorter","NodeGroupSorter","BranchAligner","NavigationalFamily","NodeProps","hasVisibleChildren","hasPartners","isPartner","hasLeavesOnly","hasChildren","typeSorter","groupSorter","VisualTreeBuilder","_treeItemCounter","_activeItems","build","orgTree","maximumId","activeItems","options","visualTree","navigationFamily","branchAligner","createVisualTreeItems","getFamily","treeItemCounter","index","leftSiblingOffset","rightSiblingOffset","orgTreeProps","loopPostOrder","nodeId","node","parentId","parent","hasOwnProperty","nodeProps","actualItemType","itemType","parentProps","isVisible","loopPreOrder","Regular","LimitedPartner","AdviserPartner","GeneralPartner","Adviser","Assistant","loopLevels","parentOrgItemId","parentOrgItem","levelid","SKIP","loopChildren","orgItemId","orgItem","treeItemProps","addChild","levelOffset","partners","getRow","advisers","length","extendChildren","placeAdvisersAboveChildren","Auto","True","alignBranches","mergeToChild","Advisers","mergeToParent","subAdvisers","SubAdviser","SubAdvisers","assistants","getRows","placeAssistantsAboveChildren","forEach","nodes","Assistants","subAssistants","SubAssistant","SubAssistants","rowChildren","RowChildren","children","Children","props","childrenRows","getRegularChildrenRows","childrenPlacementType","addSplitChildren","align","visualPartners","logicalParentItem","getNewTreeItem","visibility","Invisible","connectorPlacement","add","indexOf","countSiblings","visualParent","visualParent2","flagPartners","loopGroupTypes","groupType","len","getLength","id","push","fillEmptyLevels","rows","Items","row","depth","getRowDepth","addAdvisers","item","define","addPartners","partner","child","regularChildren","createNewVisualAggregator","loopRows","rowIndex","addAssistants","hideChildConnector","addRowChildren","horizontalAlignment","depths","getRowsDepth","addChildren","leftItems","rightItems","map","isLeft","Right","Bottom","Left","adviserPlacementType","itemProp","Top","unshift","parentIndex","centerIndex","Math","floor","invisiblePartner","splice","gravity","countChildren","mimicPartner","centerPartner","adviser","itemProps","alteredItem","nextVisualParent","assistant","rowOfChildren","medianIndex","Center","ceil","treeItem","currentVisualParent","leftChildItem","rightChildItem","newAggregatorItem","childItem","orgChildItem","width","height","twinColumns","singleItemPlacement","hideParentConnector","leavesPlacementType","Matrix","Horizontal","hideParentConnection","hideChildrenConnection","relationDegree","min","maximumColumnsInMatrix","sqrt","columnIndex","getMatrixItem","visualAggregatorId","Vertical","aggregatorItem","results","slice","items","x","y","result","isOdd","hideChildrenConnector","insert","properties","optionKey"],"sources":["C:/Users/LCGI_15/Desktop/projects/nesty-orgchart/orgchart/node_modules/basicprimitives/src/tasks/transformations/visualTreeBuilder/VisualTreeBuilder.js"],"sourcesContent":["import Tree from '../../../algorithms/Tree';\r\nimport { SideFlag, Visibility, HorizontalAlignmentType, AdviserPlacementType, \r\n  Enabled, ChildrenPlacementType, ItemType } from '../../../enums';\r\nimport TreeItem from '../../../models/TreeItem';\r\nimport { RowType, GroupType } from './enums';\r\nimport NodeTypeSorter from './NodeTypeSorter';\r\nimport NodeGroupSorter from './NodeGroupSorter';\r\nimport BranchAligner from './BranchAligner';\r\nimport NavigationalFamily from './NavigationalFamily';\r\n\r\nfunction NodeProps() {\r\n  this.hasVisibleChildren = false;\r\n  this.hasPartners = false;\r\n  this.isPartner = false;\r\n  this.hasLeavesOnly = true;\r\n  this.hasChildren = false;\r\n\r\n  this.typeSorter = NodeTypeSorter();\r\n  this.groupSorter = NodeGroupSorter();\r\n}\r\n\r\n/* method uses structures created in orgTreeTask to create visual tree used to render chart\r\n  It populates visualTree structure with TreeItem objects.\r\n*/\r\nexport default function VisualTreeBuilder() {\r\n  var _treeItemCounter,\r\n    _activeItems;\r\n\r\n  function build(orgTree, maximumId, activeItems, options) {\r\n    _treeItemCounter = maximumId;\r\n    _activeItems = activeItems;\r\n    \r\n    var {visualTree, navigationFamily, branchAligner} = createVisualTreeItems(orgTree, options, activeItems);\r\n\r\n    return {\r\n        visualTree: visualTree,\r\n        navigationFamily: navigationFamily.getFamily(),\r\n        branchAligner: branchAligner,\r\n        treeItemCounter: _treeItemCounter\r\n    };\r\n  }\r\n\r\n  function createVisualTreeItems(orgTree, options, activeItems) {\r\n    var index,\r\n      leftSiblingOffset,\r\n      rightSiblingOffset,\r\n      orgTreeProps = {},\r\n      visualTree = Tree(), /* Tree(); key: TreeItem.id value: TreeItem */\r\n      navigationFamily = NavigationalFamily(activeItems); /* Family structure where key: TreeItem.id and value: TreeItem */\r\n   \r\n    /* stage 1: orgTreeProps hash, find and set actualItemType, hasPartners, hasVisibleChildren, hasLeavesOnly */\r\n    orgTree.loopPostOrder(this, function (nodeId, node, parentId, parent) {\r\n      if(!orgTreeProps.hasOwnProperty(nodeId)) {\r\n        orgTreeProps[nodeId] = new NodeProps();\r\n      }\r\n      var nodeProps = orgTreeProps[nodeId];\r\n      nodeProps.actualItemType = node.itemType;\r\n      if (parent != null) {\r\n        if(!orgTreeProps.hasOwnProperty(parentId)) {\r\n          orgTreeProps[parentId] = new NodeProps();\r\n        }\r\n        var parentProps = orgTreeProps[parentId];\r\n        parentProps.hasVisibleChildren = parentProps.hasVisibleChildren || node.isVisible || nodeProps.hasVisibleChildren;\r\n        parentProps.hasChildren = true;\r\n        parentProps.hasLeavesOnly = parentProps.hasLeavesOnly && !nodeProps.hasChildren;\r\n      }\r\n    });\r\n\r\n    /* stage 2: convert not supported combinations of child and parent items */\r\n    orgTree.loopPreOrder(this, function (nodeId, node, parentId, parent) {\r\n      var nodeProps = orgTreeProps[nodeId];\r\n      var parentProps = orgTreeProps[parentId];\r\n      if(!parentProps) {\r\n        parentProps = new NodeProps();\r\n        parentProps.actualItemType = ItemType.Regular;\r\n        orgTreeProps[parentId] = parentProps;\r\n      }\r\n      switch (nodeProps.actualItemType) {\r\n        case ItemType.LimitedPartner:\r\n        case ItemType.AdviserPartner:\r\n        case ItemType.GeneralPartner:\r\n          /* Don't support partner of partner */\r\n          if(parentProps.isPartner) {\r\n            nodeProps.actualItemType = ItemType.Adviser;\r\n          } else {\r\n            nodeProps.isPartner = true;\r\n            parentProps.hasPartners = true;\r\n          }\r\n          break;\r\n        case ItemType.Regular:\r\n          /* Don't support regular children of partner */\r\n          if(parentProps.isPartner) {\r\n            nodeProps.actualItemType = ItemType.Assistant;\r\n          }\r\n          break;\r\n      }\r\n    });\r\n\r\n    /* stage 3: find nodes alignment levels, so nodes from different branches of the hierarchy will be placed at the same level */\r\n    var branchAligner = BranchAligner();\r\n    orgTree.loopLevels(this, function (parentOrgItemId, parentOrgItem, levelid) {\r\n      var parentProps = orgTreeProps[parentOrgItemId];\r\n      if (!parentProps.hasVisibleChildren) {\r\n        return orgTree.SKIP;\r\n      }\r\n      orgTree.loopChildren(this, parentOrgItemId, function (orgItemId, orgItem, index) {\r\n        var treeItemProps = orgTreeProps[orgItemId];\r\n        parentProps.typeSorter.addChild(treeItemProps.actualItemType, orgItem.levelOffset, orgItem);\r\n        parentProps.groupSorter.addChild(treeItemProps.actualItemType, orgItem.levelOffset, orgItem);\r\n      });\r\n\r\n      var partners = [];\r\n      if(parentProps.hasPartners) {\r\n        partners = [...parentProps.typeSorter.getRow(ItemType.AdviserPartner), ...parentProps.typeSorter.getRow(ItemType.LimitedPartner), ...parentProps.typeSorter.getRow(ItemType.GeneralPartner)];\r\n      }\r\n      var advisers = parentProps.typeSorter.getRow(ItemType.Adviser);\r\n      if(advisers.length > 0) {\r\n        /* extend advisers level */\r\n        var extendChildren = partners.length > 0;\r\n        if(!extendChildren) {\r\n          switch (parentOrgItem.placeAdvisersAboveChildren) {\r\n            case Enabled.Auto:\r\n              extendChildren = options.placeAdvisersAboveChildren;\r\n              break;\r\n            case Enabled.True:\r\n              extendChildren = true;\r\n              break;\r\n          }\r\n        }\r\n        if(options.alignBranches) {\r\n          if(parentProps.isPartner) {\r\n            extendChildren = true;\r\n          }\r\n          if(extendChildren) {\r\n            branchAligner.mergeToChild(parentOrgItemId, advisers, RowType.Advisers, 0, 0, extendChildren);\r\n          } else {\r\n            branchAligner.mergeToParent(parentOrgItemId, advisers);\r\n          }\r\n        } else {\r\n          branchAligner.addChild(parentOrgItemId, advisers, RowType.Advisers, 0, 0, extendChildren);\r\n        }\r\n      }\r\n\r\n      var subAdvisers = parentProps.typeSorter.getRow(ItemType.SubAdviser);\r\n      if(subAdvisers.length > 0) {\r\n        /* extend advisers level */\r\n        var extendChildren = partners.length > 0;\r\n        if(!extendChildren) {\r\n          switch (parentOrgItem.placeAdvisersAboveChildren) {\r\n            case Enabled.Auto:\r\n              extendChildren = options.placeAdvisersAboveChildren;\r\n              break;\r\n            case Enabled.True:\r\n              extendChildren = true;\r\n              break;\r\n          }\r\n        }\r\n        if(options.alignBranches) {\r\n          if(parentProps.isPartner) {\r\n            extendChildren = true;\r\n          }\r\n          branchAligner.mergeToChild(parentOrgItemId, subAdvisers, RowType.SubAdvisers, 0, 1, extendChildren);\r\n\r\n        } else {\r\n          branchAligner.addChild(parentOrgItemId, subAdvisers, RowType.SubAdvisers, 0, 1, extendChildren);\r\n        }\r\n      }\r\n\r\n      var assistants = parentProps.typeSorter.getRows(ItemType.Assistant);\r\n      /* create assistants levels */\r\n      if(assistants.length > 0) {\r\n        /* extend assistants levels */\r\n        var extendChildren = partners.length > 0;\r\n        if(!extendChildren) {\r\n          switch (parentOrgItem.placeAssistantsAboveChildren) {\r\n            case Enabled.Auto:\r\n              extendChildren = options.placeAssistantsAboveChildren;\r\n              break;\r\n            case Enabled.True:\r\n              extendChildren = true;\r\n              break;\r\n          }\r\n        }\r\n        assistants.forEach((nodes, index) => {\r\n          if(options.alignBranches) {\r\n            branchAligner.mergeToChild(parentOrgItemId, nodes, RowType.Assistants, index, 0, extendChildren);\r\n          } else {\r\n            branchAligner.addChild(parentOrgItemId, nodes, RowType.Assistants, index, 0, extendChildren);\r\n          }\r\n        });\r\n      }\r\n\r\n      var subAssistants = parentProps.typeSorter.getRows(ItemType.SubAssistant);\r\n      /* create assistants levels */\r\n      if(subAssistants.length > 0) {\r\n        /* extend assistants levels */\r\n        var extendChildren = partners.length > 0;\r\n        if(!extendChildren) {\r\n          switch (parentOrgItem.placeAssistantsAboveChildren) {\r\n            case Enabled.Auto:\r\n              extendChildren = options.placeAssistantsAboveChildren;\r\n              break;\r\n            case Enabled.True:\r\n              extendChildren = true;\r\n              break;\r\n          }\r\n        }\r\n        subAssistants.forEach((nodes, index) => {\r\n          if(options.alignBranches) {\r\n            branchAligner.mergeToChild(parentOrgItemId, nodes, RowType.SubAssistants, index, 1, extendChildren);\r\n          } else {\r\n            branchAligner.addChild(parentOrgItemId, nodes, RowType.SubAssistants, index, 1, extendChildren);\r\n          }\r\n        });\r\n      }\r\n\r\n      if(partners.length > 0) {\r\n        branchAligner.mergeToParent(parentOrgItemId, partners);\r\n      }\r\n\r\n      var rowChildren = parentProps.groupSorter.getRows(GroupType.RowChildren);\r\n      /* create row children levels */\r\n      if(rowChildren.length > 0) {\r\n        rowChildren.forEach((nodes, index) => {\r\n          if(options.alignBranches) {\r\n            branchAligner.mergeToChild(parentOrgItemId, nodes, RowType.RowChildren, index, 0, true);\r\n          } else {\r\n            branchAligner.addChild(parentOrgItemId, nodes, RowType.RowChildren, index, 0, true);\r\n          }\r\n        });\r\n      }\r\n\r\n      /* add remaining children in formation */\r\n      var children = parentProps.groupSorter.getRow(GroupType.Children);\r\n      if(children.length > 0) {\r\n        var props = orgTreeProps[parentOrgItemId];\r\n        var childrenRows = getRegularChildrenRows(options, children, parentOrgItem.childrenPlacementType, props.hasLeavesOnly);\r\n        childrenRows.forEach((nodes, index) => {\r\n          if(options.alignBranches) {\r\n            branchAligner.mergeToChild(parentOrgItemId, nodes, RowType.Children, index, 0, true);\r\n          } else {\r\n            if(index == childrenRows.length - 1) {\r\n              branchAligner.addSplitChildren(parentOrgItemId, nodes, RowType.Children, index, 0);\r\n            } else {\r\n              branchAligner.addChild(parentOrgItemId, nodes, RowType.Children, index, 0, true);\r\n            }\r\n          }\r\n        });\r\n      }\r\n    });\r\n\r\n    /* stage 4: measure depth of alignment levels */\r\n    branchAligner.align();\r\n\r\n    /* stage 5: create visual tree */\r\n    var visualPartners = {};\r\n    orgTree.loopLevels(this, function (parentOrgItemId, parentOrgItem, levelid) {\r\n      var parentProps = orgTreeProps[parentOrgItemId];\r\n\r\n      var logicalParentItem = visualTree.node(parentOrgItemId);\r\n      if (!logicalParentItem) {\r\n        logicalParentItem = getNewTreeItem({\r\n          visibility: Visibility.Invisible,\r\n          connectorPlacement: 0,\r\n          parentId: null,\r\n          actualItemType: ItemType.Regular\r\n        }, parentOrgItem);\r\n        visualTree.add(null, parentOrgItemId, logicalParentItem);\r\n      }\r\n\r\n      /* find left and right siblings margins of logical parent item\r\n        they are needed to properly place GeneralPartner & LimitedPartner nodes. */\r\n      leftSiblingOffset = 0;\r\n      rightSiblingOffset = 0;\r\n      if ((index = visualTree.indexOf(parentOrgItemId)) != null) {\r\n        leftSiblingOffset = index;\r\n        rightSiblingOffset = visualTree.countSiblings(parentOrgItemId) - index - 1;\r\n      }\r\n\r\n      var partners = [];\r\n      if(parentProps.hasPartners) {\r\n        partners = [\r\n          ...parentProps.typeSorter.getRow(ItemType.AdviserPartner), \r\n          ...parentProps.typeSorter.getRow(ItemType.LimitedPartner), \r\n          ...parentProps.typeSorter.getRow(ItemType.GeneralPartner)\r\n        ];\r\n      }\r\n      var visualParent = logicalParentItem;\r\n      var visualParent2 = null;\r\n      var flagPartners = true;\r\n      branchAligner.loopGroupTypes(this, parentOrgItemId, function(groupType, len) {\r\n        if(!(parentProps.hasPartners || parentProps.isPartner) && groupType > parentProps.groupSorter.getLength() - 1) {\r\n          return true;\r\n        }\r\n        if(groupType > GroupType.Assistants && flagPartners) {\r\n          flagPartners = false;\r\n          if(parentProps.hasPartners) {\r\n            visualPartners[parentOrgItemId] = [visualParent.id];\r\n            visualParent = visualParent2 || visualParent;\r\n            visualParent2 = null;\r\n            visualParent.partners = visualPartners[parentOrgItemId];\r\n          }\r\n          if(parentProps.isPartner) {\r\n            visualPartners[parentOrgItem.parent].push(visualParent.id);\r\n          }\r\n        }\r\n        var fillEmptyLevels = ((parentProps.isPartner || parentProps.hasPartners) && groupType <= GroupType.Assistants);\r\n        fillEmptyLevels = fillEmptyLevels || groupType < parentProps.groupSorter.getLength() - 1;\r\n\r\n        var rows = [];\r\n        switch(groupType) {\r\n          case GroupType.Items:\r\n            var row = parentProps.groupSorter.getRows(GroupType.Items)[0] || [];\r\n            var depth = branchAligner.getRowDepth(parentOrgItemId, GroupType.Items, 0);\r\n            addAdvisers(visualTree, orgTreeProps, visualParent, row, leftSiblingOffset, rightSiblingOffset);\r\n            row.forEach(item => navigationFamily.define(parentOrgItem, item));\r\n            if(partners.length > 0) {\r\n              visualParent2 = addPartners(visualTree, orgTreeProps, visualParent, partners, leftSiblingOffset, rightSiblingOffset);\r\n              /* every child logically belongs to every partner */\r\n              partners.forEach( partner => {\r\n                navigationFamily.define(parentOrgItem, partner, true);\r\n                if(partner.id != logicalParentItem.id) {\r\n                  var rowChildren = parentProps.groupSorter.getRows(GroupType.RowChildren);\r\n                  rowChildren.forEach(row => row.forEach(child => navigationFamily.define(partner, child)));\r\n                  var regularChildren = parentProps.groupSorter.getRow(GroupType.Children);\r\n                  regularChildren.forEach(child => navigationFamily.define(partner, child));\r\n                }\r\n              })\r\n            }\r\n            if(parentProps.hasPartners || parentProps.isPartner || groupType < parentProps.groupSorter.getLength() - 1) {\r\n              while(depth > 1) {\r\n                visualParent = createNewVisualAggregator(visualTree, visualParent, false);\r\n                if(visualParent2) {\r\n                  visualParent2 = createNewVisualAggregator(visualTree, visualParent2, false);\r\n                }\r\n                depth-=1;\r\n              }\r\n            }\r\n            break;\r\n          case GroupType.Assistants:\r\n            var rows = parentProps.groupSorter.getRows(GroupType.Assistants);\r\n            branchAligner.loopRows(this, parentOrgItemId, RowType.Assistants, function(depth, rowIndex) {\r\n              var row = rows[rowIndex] || [];\r\n              if(!fillEmptyLevels && rowIndex > rows.length - 1) {\r\n                return true;\r\n              }\r\n              visualParent = addAssistants(visualTree, orgTreeProps, visualParent, row);\r\n              if(visualParent2) {\r\n                visualParent2 = createNewVisualAggregator(visualTree, visualParent2, false);\r\n              }\r\n              row.forEach(item => navigationFamily.define(parentOrgItem, item));\r\n              if(parentProps.hasPartners || parentProps.isPartner || rowIndex < rows.length - 1 || groupType < parentProps.groupSorter.getLength() - 1) {\r\n                while(depth > 1) {\r\n                  visualParent = createNewVisualAggregator(visualTree, visualParent, false);\r\n                  if(visualParent2) {\r\n                    visualParent2 = createNewVisualAggregator(visualTree, visualParent2, false);\r\n                  }\r\n                  depth-=1;\r\n                }\r\n              }\r\n            });\r\n            break;\r\n          case GroupType.RowChildren:\r\n            var rows = parentProps.groupSorter.getRows(GroupType.RowChildren);\r\n            branchAligner.loopRows(this, parentOrgItemId, RowType.RowChildren, function(depth, rowIndex) {\r\n              var row = rows[rowIndex] || [];\r\n              if(!fillEmptyLevels && rowIndex > rows.length - 1) {\r\n                return true;\r\n              }\r\n              var hideChildConnector = (logicalParentItem.visibility == Visibility.Invisible) && (logicalParentItem.connectorPlacement === 0);\r\n              visualParent = addRowChildren(visualTree, visualParent, row, fillEmptyLevels || rowIndex < rows.length - 1, hideChildConnector, options.horizontalAlignment);\r\n              row.forEach(item => navigationFamily.define(parentOrgItem, item));\r\n              if(rowIndex < rows.length - 1 || groupType < parentProps.groupSorter.getLength() - 1) {\r\n                while(depth > 1) {\r\n                  visualParent = createNewVisualAggregator(visualTree, visualParent, false);\r\n                  depth-=1;\r\n                }\r\n              }\r\n            });\r\n            break;\r\n          case GroupType.Children:\r\n            var regularChildren = parentProps.groupSorter.getRow(GroupType.Children); /* children added after all other custom item types */\r\n            /* add remaining children in formation */\r\n            if(regularChildren.length > 0) {\r\n              var props = orgTreeProps[logicalParentItem.id];\r\n              var depths = branchAligner.getRowsDepth(parentOrgItemId, GroupType.Children);\r\n              addChildren(orgTree, visualTree, depths, options, logicalParentItem, visualParent, regularChildren, parentOrgItem.childrenPlacementType, props.hasLeavesOnly);\r\n              regularChildren.forEach(item => navigationFamily.define(parentOrgItem, item));\r\n            }\r\n            break;\r\n        }\r\n      });\r\n      if(flagPartners) {\r\n        flagPartners = false;\r\n        if(parentProps.hasPartners) {\r\n          visualPartners[parentOrgItemId] = [visualParent.id];\r\n          visualParent = visualParent2 || visualParent;\r\n          visualParent2 = null;\r\n          visualParent.partners = visualPartners[parentOrgItemId];\r\n        }\r\n        if(parentProps.isPartner) {\r\n          visualPartners[parentOrgItem.parent].push(visualParent.id);\r\n        }\r\n      }\r\n      if (!parentProps.hasVisibleChildren) {\r\n        return orgTree.SKIP;\r\n      }\r\n    });\r\n\r\n    return {\r\n        visualTree: visualTree,\r\n        navigationFamily: navigationFamily,\r\n        branchAligner: branchAligner\r\n    }\r\n  }\r\n\r\n  function addPartners(visualTree, orgTreeProps, parent, partners, leftSiblingOffset, rightSiblingOffset) {\r\n    var leftItems = [];\r\n    var rightItems = [];\r\n    partners.map(partner => getNewTreeItem({}, partner)).forEach(item => {\r\n      var isLeft = true;\r\n      if (parent.connectorPlacement & SideFlag.Right) {\r\n        isLeft = true;\r\n        item.connectorPlacement = SideFlag.Right | SideFlag.Bottom;\r\n      } else if (parent.connectorPlacement & SideFlag.Left) {\r\n        isLeft = false;\r\n        item.connectorPlacement = SideFlag.Left | SideFlag.Bottom;\r\n      } else {\r\n        switch (item.adviserPlacementType) {\r\n          case AdviserPlacementType.Left:\r\n            isLeft = true;\r\n            item.connectorPlacement = SideFlag.Right | SideFlag.Bottom;\r\n            break;\r\n          default:\r\n            isLeft = false;\r\n            item.connectorPlacement = SideFlag.Left | SideFlag.Bottom;\r\n            break;\r\n        }\r\n        var itemProp = orgTreeProps[item.id];\r\n        switch (itemProp.actualItemType) {\r\n          case ItemType.GeneralPartner:\r\n            item.connectorPlacement = SideFlag.Top | SideFlag.Bottom;\r\n            break;\r\n          case ItemType.LimitedPartner:\r\n            item.connectorPlacement = SideFlag.Bottom;\r\n            break;\r\n          default:\r\n            break;\r\n        }\r\n      }\r\n      if(isLeft) {\r\n        leftItems.unshift(item);\r\n      } else {\r\n        rightItems.push(item);\r\n      }\r\n    });\r\n\r\n    var partners = [...leftItems, parent, ...rightItems];\r\n    var parentIndex = leftItems.length;\r\n    var centerIndex = Math.floor((partners.length) / 2);\r\n    var invisiblePartner = null;\r\n    if(partners.length % 2 == 0) {\r\n      invisiblePartner = getNewTreeItem({ visibility: Visibility.Invisible });\r\n      partners.splice(centerIndex, 0, invisiblePartner);\r\n      if(centerIndex <= parentIndex) {\r\n        parentIndex+=1;\r\n      }\r\n    }\r\n\r\n    var visualParent = visualTree.parent(parent.id);\r\n    for (var index = parentIndex - 1; index >= 0; index -= 1) {\r\n      var item = partners[index];\r\n      visualTree.add(visualParent.id, item.id, item, leftSiblingOffset);\r\n\r\n      item.gravity = HorizontalAlignmentType.Right;\r\n    }\r\n    for (var index = parentIndex + 1; index < partners.length; index += 1) {\r\n      var item = partners[index];\r\n      visualTree.add(visualParent.id, item.id, item, visualTree.countChildren(visualParent.id) - rightSiblingOffset);\r\n      \r\n      item.gravity = HorizontalAlignmentType.Left;\r\n    }\r\n\r\n    if(invisiblePartner != null) {\r\n      var mimicPartner = null;\r\n      if(centerIndex <= parentIndex) {\r\n        mimicPartner = partners[centerIndex - 1];\r\n      } else {\r\n        mimicPartner = partners[centerIndex + 1];\r\n      }\r\n      invisiblePartner.connectorPlacement = mimicPartner.connectorPlacement & (SideFlag.Left | SideFlag.Right);\r\n    }\r\n\r\n    var centerPartner = partners[centerIndex];\r\n    return centerPartner;\r\n  }\r\n\r\n  function addAdvisers(visualTree, orgTreeProps, parent, advisers, leftSiblingOffset, rightSiblingOffset) {\r\n    advisers.map(adviser => getNewTreeItem({}, adviser)).forEach(item => {\r\n      var itemProps = orgTreeProps[item.id];\r\n      var alteredItem;\r\n      switch(itemProps.actualItemType) {\r\n        case ItemType.SubAdviser:\r\n          item.connectorPlacement = SideFlag.Top | SideFlag.Bottom;\r\n          alteredItem = getNewTreeItem({ visibility: Visibility.Invisible });\r\n          visualTree.add(alteredItem.id, item.id, item);\r\n          break;\r\n        default:\r\n          alteredItem = item;\r\n          break;\r\n      }\r\n      var visualParent = visualTree.parent(parent.id);\r\n      if (parent.connectorPlacement & SideFlag.Right) {\r\n        visualTree.add(visualParent.id, alteredItem.id, alteredItem, leftSiblingOffset);\r\n        alteredItem.connectorPlacement = SideFlag.Right | SideFlag.Bottom;\r\n        alteredItem.gravity = HorizontalAlignmentType.Right;\r\n      } else if (parent.connectorPlacement & SideFlag.Left) {\r\n        visualTree.add(visualParent.id, alteredItem.id, alteredItem, visualTree.countChildren(visualParent.id) - rightSiblingOffset);\r\n        alteredItem.connectorPlacement = SideFlag.Left | SideFlag.Bottom;\r\n        alteredItem.gravity = HorizontalAlignmentType.Left;\r\n      } else {\r\n        switch (item.adviserPlacementType) {\r\n          case AdviserPlacementType.Left:\r\n            visualTree.add(visualParent.id, alteredItem.id, alteredItem, leftSiblingOffset);\r\n            alteredItem.connectorPlacement = SideFlag.Right | SideFlag.Bottom;\r\n            alteredItem.gravity = HorizontalAlignmentType.Right;\r\n            break;\r\n          default:\r\n            visualTree.add(visualParent.id, alteredItem.id, alteredItem, visualTree.countChildren(visualParent.id) - rightSiblingOffset);\r\n            alteredItem.connectorPlacement = SideFlag.Left | SideFlag.Bottom;\r\n            alteredItem.gravity = HorizontalAlignmentType.Left;\r\n            break;\r\n        }\r\n        switch (item.actualItemType) {\r\n          case ItemType.GeneralPartner:\r\n            alteredItem.connectorPlacement = SideFlag.Top | SideFlag.Bottom;\r\n            break;\r\n          case ItemType.LimitedPartner:\r\n            alteredItem.connectorPlacement = SideFlag.Bottom;\r\n            break;\r\n        }\r\n      }\r\n    })\r\n  }\r\n  \r\n  function addAssistants(visualTree, orgTreeProps, visualParent, assistants) {\r\n    var nextVisualParent = createNewVisualAggregator(visualTree, visualParent, false);\r\n    assistants.map(assistant => getNewTreeItem({}, assistant)).forEach(item => {\r\n      var itemProps = orgTreeProps[item.id];\r\n      var alteredItem;\r\n      switch(itemProps.actualItemType) {\r\n        case ItemType.SubAssistant:\r\n          item.connectorPlacement = SideFlag.Top | SideFlag.Bottom;\r\n          alteredItem = getNewTreeItem({ visibility: Visibility.Invisible });\r\n          visualTree.add(alteredItem.id, item.id, item);\r\n          break;\r\n        case ItemType.Assistant:\r\n          alteredItem = item;\r\n          break;\r\n      }\r\n      switch (item.adviserPlacementType) {\r\n        case AdviserPlacementType.Left:\r\n          visualTree.add(visualParent.id, alteredItem.id, alteredItem, 0);\r\n          alteredItem.connectorPlacement = SideFlag.Right | SideFlag.Bottom;\r\n          alteredItem.gravity = HorizontalAlignmentType.Right;\r\n          break;\r\n        default:\r\n          visualTree.add(visualParent.id, alteredItem.id, alteredItem);\r\n          alteredItem.connectorPlacement = SideFlag.Left | SideFlag.Bottom;\r\n          alteredItem.gravity = HorizontalAlignmentType.Left;\r\n          break;\r\n      }\r\n    });\r\n    return nextVisualParent;\r\n  }\r\n\r\n  function addRowChildren(visualTree, visualParent, rowOfChildren, fillEmptyLevels, hideChildConnector, horizontalAlignment) {\r\n    var nextVisualParent = null;\r\n    if(fillEmptyLevels) {\r\n      nextVisualParent = createNewVisualAggregator(visualTree, visualParent, hideChildConnector);\r\n    }\r\n    var medianIndex = 0;\r\n    switch (horizontalAlignment) {\r\n      case HorizontalAlignmentType.Center:\r\n        medianIndex = Math.ceil(rowOfChildren.length / 2) - 1;\r\n        break;\r\n      case HorizontalAlignmentType.Left:\r\n        medianIndex = -1;\r\n        break;\r\n      case HorizontalAlignmentType.Right:\r\n        medianIndex = rowOfChildren.length - 1;\r\n        break;\r\n    }\r\n    for (var index = medianIndex; index >= 0; index -= 1) {\r\n      var item = getNewTreeItem({}, rowOfChildren[index]);\r\n      visualTree.add(visualParent.id, item.id, item, 0);\r\n      item.connectorPlacement = SideFlag.Top | SideFlag.Bottom;\r\n      item.gravity = HorizontalAlignmentType.Right;\r\n    }\r\n\r\n    for (index = medianIndex + 1; index < rowOfChildren.length; index += 1) {\r\n      item = getNewTreeItem({}, rowOfChildren[index]);\r\n      visualTree.add(visualParent.id, item.id, item);\r\n      item.connectorPlacement = SideFlag.Top | SideFlag.Bottom;\r\n      item.gravity = HorizontalAlignmentType.Left;\r\n    }\r\n    return nextVisualParent;\r\n  }\r\n\r\n  function addChildren(orgTree, visualTree, depths, options, treeItem, visualParent, regularChildren, childrenPlacementType, hasLeavesOnly) {\r\n    var visualParent,\r\n      currentVisualParent,\r\n      leftChildItem,\r\n      rightChildItem,\r\n      newAggregatorItem,\r\n      childItem, orgChildItem,\r\n      width,\r\n      height,\r\n      twinColumns,\r\n      rowIndex,\r\n      index, len,\r\n      singleItemPlacement,\r\n      hideParentConnector = (treeItem.visibility == Visibility.Invisible) && (treeItem.connectorPlacement === 0);\r\n\r\n    switch (options.horizontalAlignment) {\r\n      case HorizontalAlignmentType.Center:\r\n      case HorizontalAlignmentType.Left:\r\n        singleItemPlacement = AdviserPlacementType.Right;\r\n        break;\r\n      case HorizontalAlignmentType.Right:\r\n        singleItemPlacement = AdviserPlacementType.Left;\r\n        break;\r\n    }\r\n\r\n    if (childrenPlacementType === ChildrenPlacementType.Auto) {\r\n      if (hasLeavesOnly) {\r\n        childrenPlacementType = (options.leavesPlacementType === ChildrenPlacementType.Auto) ?\r\n          ChildrenPlacementType.Matrix : options.leavesPlacementType;\r\n      }\r\n      else {\r\n        childrenPlacementType = (options.childrenPlacementType === ChildrenPlacementType.Auto) ?\r\n          ChildrenPlacementType.Horizontal : options.childrenPlacementType;\r\n      }\r\n    }\r\n\r\n    if (childrenPlacementType == ChildrenPlacementType.Matrix && regularChildren.length < 3) {\r\n      childrenPlacementType = ChildrenPlacementType.Horizontal;\r\n    }\r\n\r\n    switch (childrenPlacementType) {\r\n      case ChildrenPlacementType.Horizontal:\r\n        for (index = 0, len = regularChildren.length; index < len; index += 1) {\r\n          childItem = getNewTreeItem({}, regularChildren[index]);\r\n          orgChildItem = orgTree.node(childItem.id);\r\n          visualTree.add(visualParent.id, childItem.id, childItem);\r\n          childItem.connectorPlacement = (orgChildItem.hideParentConnection ? 0 : SideFlag.Top) | (orgChildItem.hideChildrenConnection ? 0 : SideFlag.Bottom);\r\n\r\n          if (index === 0) {\r\n            childItem.relationDegree = 1;\r\n          }\r\n        }\r\n        break;\r\n      case ChildrenPlacementType.Matrix:\r\n        width = Math.min(options.maximumColumnsInMatrix, Math.ceil(Math.sqrt(regularChildren.length)));\r\n        height = Math.ceil(regularChildren.length / width);\r\n        twinColumns = Math.ceil(width / 2.0);\r\n        for (var columnIndex = 0; columnIndex < twinColumns; columnIndex += 1) {\r\n          currentVisualParent = visualParent;\r\n          for (rowIndex = 0; rowIndex < height; rowIndex += 1) {\r\n            leftChildItem = getMatrixItem(regularChildren, columnIndex * 2, rowIndex, width);\r\n            rightChildItem = getMatrixItem(regularChildren, columnIndex * 2 + 1, rowIndex, width);\r\n            if (leftChildItem !== null || rightChildItem !== null) {\r\n              var depth = depths[rowIndex - 1] || 1;\r\n              while(depth > 1) {\r\n                newAggregatorItem = getNewTreeItem({\r\n                  visibility: Visibility.Invisible,\r\n                  connectorPlacement: hideParentConnector ? 0 : SideFlag.Top | SideFlag.Bottom\r\n                });\r\n                visualTree.add(currentVisualParent.id, newAggregatorItem.id, newAggregatorItem);\r\n                currentVisualParent = newAggregatorItem;\r\n                depth -= 1;\r\n              }\r\n            }\r\n            if (leftChildItem !== null) {\r\n              leftChildItem =  getNewTreeItem({},leftChildItem);\r\n              if (columnIndex === 0) {\r\n                leftChildItem.relationDegree = 1;\r\n              }\r\n              visualTree.add(currentVisualParent.id, leftChildItem.id, leftChildItem);\r\n              leftChildItem.connectorPlacement = (hideParentConnector ? 0 : SideFlag.Right) | SideFlag.Bottom;\r\n              leftChildItem.gravity = HorizontalAlignmentType.Right;\r\n            }\r\n            if (leftChildItem !== null || rightChildItem !== null) {\r\n              newAggregatorItem = getNewTreeItem({\r\n                visibility: Visibility.Invisible,\r\n                connectorPlacement: hideParentConnector ? 0 : SideFlag.Top | SideFlag.Bottom\r\n              });\r\n              visualTree.add(currentVisualParent.id, newAggregatorItem.id, newAggregatorItem);\r\n            }\r\n            if (rightChildItem !== null) {\r\n              rightChildItem = getNewTreeItem({},rightChildItem);\r\n              visualTree.add(currentVisualParent.id, rightChildItem.id, rightChildItem);\r\n              rightChildItem.connectorPlacement = (hideParentConnector ? 0 : SideFlag.Left) | SideFlag.Bottom;\r\n              rightChildItem.gravity = HorizontalAlignmentType.Left;\r\n            }\r\n            currentVisualParent = newAggregatorItem;\r\n          }\r\n        }\r\n        if (width > 2) {\r\n          // No center alignment to aggregator required\r\n          visualParent.visualAggregatorId = null;\r\n        }\r\n        break;\r\n      case ChildrenPlacementType.Vertical:\r\n        for (index = 0, len = regularChildren.length; index < len; index += 1) {\r\n          childItem = getNewTreeItem({}, regularChildren[index]);\r\n          var depth = (index == len - 1) ?  1 : depths[index] || 1;\r\n          var aggregatorItem = visualParent;\r\n          while(depth > 0) {\r\n            newAggregatorItem = getNewTreeItem({\r\n              visibility: Visibility.Invisible,\r\n              connectorPlacement: hideParentConnector ? 0 : SideFlag.Top | SideFlag.Bottom\r\n            });\r\n            visualTree.add(aggregatorItem.id, newAggregatorItem.id, newAggregatorItem);\r\n            aggregatorItem = newAggregatorItem;\r\n            depth -= 1;\r\n          }\r\n\r\n          switch (singleItemPlacement) {\r\n            case AdviserPlacementType.Left:\r\n              visualTree.add(visualParent.id, childItem.id, childItem, 0);\r\n              childItem.connectorPlacement = (hideParentConnector ? 0 : SideFlag.Right) | SideFlag.Bottom;\r\n              childItem.gravity = HorizontalAlignmentType.Right;\r\n              break;\r\n            case AdviserPlacementType.Right:\r\n              visualTree.add(visualParent.id, childItem.id, childItem);\r\n              childItem.connectorPlacement = (hideParentConnector ? 0 : SideFlag.Left) | SideFlag.Bottom;\r\n              childItem.gravity = HorizontalAlignmentType.Left;\r\n              break;\r\n          }\r\n          visualParent = newAggregatorItem;\r\n        }\r\n        break;\r\n      default:\r\n        throw \"Children placement is undefined!\";\r\n    }\r\n  }\r\n\r\n  function getRegularChildrenRows(options, regularChildren, childrenPlacementType, hasLeavesOnly) {\r\n    var results = [];\r\n\r\n    if (childrenPlacementType === ChildrenPlacementType.Auto) {\r\n      if (hasLeavesOnly) {\r\n        childrenPlacementType = (options.leavesPlacementType === ChildrenPlacementType.Auto) ?\r\n          ChildrenPlacementType.Matrix : options.leavesPlacementType;\r\n      }\r\n      else {\r\n        childrenPlacementType = (options.childrenPlacementType === ChildrenPlacementType.Auto) ?\r\n          ChildrenPlacementType.Horizontal : options.childrenPlacementType;\r\n      }\r\n    }\r\n\r\n    if (childrenPlacementType == ChildrenPlacementType.Matrix && regularChildren.length < 3) {\r\n      childrenPlacementType = ChildrenPlacementType.Horizontal;\r\n    }\r\n\r\n    switch (childrenPlacementType) {\r\n      case ChildrenPlacementType.Horizontal:\r\n        results.push(regularChildren);\r\n        break;\r\n      case ChildrenPlacementType.Matrix:\r\n        var width = Math.min(options.maximumColumnsInMatrix, Math.ceil(Math.sqrt(regularChildren.length)));\r\n        for(var index = 0; index < regularChildren.length; index+= width) {\r\n          results.push(regularChildren.slice(index, index + width));\r\n        }\r\n        break;\r\n      case ChildrenPlacementType.Vertical:\r\n        regularChildren.forEach(childItem => {\r\n          results.push([childItem])\r\n        })\r\n        break;\r\n    }\r\n    return results;\r\n  }\r\n\r\n  function getMatrixItem(items, x, y, width) {\r\n    var result,\r\n      isOdd = (width % 2 > 0),\r\n      index;\r\n\r\n    if (isOdd) {\r\n      if (x === width - 1) {\r\n        x = items.length;\r\n      }\r\n      else if (x === width) {\r\n        x = width - 1;\r\n      }\r\n    }\r\n    index = y * width + x;\r\n\r\n    result = (index > items.length - 1) ? null : items[index];\r\n\r\n    return result;\r\n  }\r\n\r\n  function createNewVisualAggregator(visualTree, treeItem, hideChildrenConnector) {\r\n    var newAggregatorItem,\r\n      hideParentConnector = ((treeItem.visibility == Visibility.Invisible) && ((treeItem.connectorPlacement & SideFlag.Top) === 0)) || hideChildrenConnector;\r\n\r\n    newAggregatorItem = getNewTreeItem({\r\n      visibility: Visibility.Invisible,\r\n      visualAggregatorId: treeItem.visualAggregatorId,\r\n      connectorPlacement: hideParentConnector ? 0 : (SideFlag.Top | SideFlag.Bottom)\r\n    });\r\n\r\n    visualTree.insert(treeItem.id, newAggregatorItem.id, newAggregatorItem);\r\n\r\n    treeItem.visualAggregatorId = newAggregatorItem.id;\r\n    return newAggregatorItem;\r\n  }\r\n\r\n  function getNewTreeItem(properties, orgItem) {\r\n    var result = new TreeItem(),\r\n      optionKey;\r\n\r\n    if (orgItem != null) {\r\n      result.actualItemType = orgItem.itemType;\r\n      result.adviserPlacementType = orgItem.adviserPlacementType;\r\n    }\r\n\r\n    for (optionKey in properties) {\r\n      if (properties.hasOwnProperty(optionKey)) {\r\n        result[optionKey] = properties[optionKey];\r\n      }\r\n    }\r\n\r\n    if (orgItem != null) {\r\n      result.id = orgItem.id;\r\n      result.visibility = orgItem.isVisible ? Visibility.Auto : Visibility.Invisible;\r\n    } else {\r\n      _treeItemCounter += 1;\r\n      result.id = _treeItemCounter;\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n  return {\r\n    build: build\r\n  };\r\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}