{"ast":null,"code":"import Tree from '../../../algorithms/Tree';\nimport { AdviserPlacementType } from '../../../enums';\nexport default function UserDefinedNodesOrder() {}\n;\nUserDefinedNodesOrder.prototype.getUserDefinedPositions = function (items) {\n  var userItem,\n    index,\n    len,\n    relationTree = Tree(),\n    referencedItems = {};\n  for (index = 0, len = items.length; index < len; index += 1) {\n    userItem = items[index];\n    /* user should define unique id for every FamItemConfig otherwise we ignore it\r\n       user should define relativeItem otherwise we cannot position item\r\n    */\n    if (userItem.relativeItem != null) {\n      referencedItems[userItem.relativeItem] = true;\n    }\n    if (userItem.id != null) {\n      referencedItems[userItem.id] = true;\n    }\n  }\n\n  /* convert items relations into tree, it is not necessary to be a single root tree */\n  for (index = 0, len = items.length; index < len; index += 1) {\n    userItem = items[index];\n    if (referencedItems.hasOwnProperty(userItem.id)) {\n      var relativeItem = userItem.relativeItem || null;\n      relationTree.add(relativeItem, userItem.id, userItem);\n    }\n  }\n\n  /* at this step relationTree should contain some set of root items \r\n    if it has no root items that means we ether don't have any user defined relations\r\n    or relations tree is looped so we ignore loops\r\n  */\n  function Set(position, items) {\n    this.position = position;\n    this.items = items;\n  }\n  var itemsOrder = {};\n  var lefts = {};\n  var rights = {};\n  relationTree.loopPostOrder(this, function (nodeid, node, parentid, parent) {\n    var items = [],\n      leftItems = lefts[nodeid],\n      rightItems = rights[nodeid],\n      index;\n    if (leftItems != null) {\n      leftItems.sort(function (a, b) {\n        return b.position - a.position;\n      });\n      for (index = 0; index < leftItems.length; index += 1) {\n        items = items.concat(leftItems[index].items);\n      }\n    }\n    items.push(nodeid);\n    if (rightItems != null) {\n      rightItems.sort(function (a, b) {\n        return a.position - b.position;\n      });\n      for (index = 0; index < rightItems.length; index += 1) {\n        items = items.concat(rightItems[index].items);\n      }\n    }\n    if (parentid != null) {\n      if (node.placementType == AdviserPlacementType.Left) {\n        if (!lefts.hasOwnProperty(parentid)) {\n          lefts[parentid] = [];\n        }\n        lefts[parentid].push(new Set(node.position, items));\n      } else {\n        if (!rights.hasOwnProperty(parentid)) {\n          rights[parentid] = [];\n        }\n        rights[parentid].push(new Set(node.position, items));\n      }\n    } else {\n      itemsOrder[nodeid] = items;\n    }\n  });\n\n  /* convert root items collections into a sinle result hash */\n  var position = {},\n    group = {};\n  for (var rootItemId in itemsOrder) {\n    if (itemsOrder.hasOwnProperty(rootItemId)) {\n      items = itemsOrder[rootItemId];\n      for (index = 0; index < items.length; index += 1) {\n        var itemid = items[index];\n        position[itemid] = index;\n        group[itemid] = rootItemId;\n      }\n    }\n  }\n  return {\n    position: position,\n    group: group\n  };\n};","map":{"version":3,"names":["Tree","AdviserPlacementType","UserDefinedNodesOrder","prototype","getUserDefinedPositions","items","userItem","index","len","relationTree","referencedItems","length","relativeItem","id","hasOwnProperty","add","Set","position","itemsOrder","lefts","rights","loopPostOrder","nodeid","node","parentid","parent","leftItems","rightItems","sort","a","b","concat","push","placementType","Left","group","rootItemId","itemid"],"sources":["/Users/iamnestyyy/ReactProjects/orgchart/node_modules/basicprimitives/src/tasks/transformations/familyTransformations/UserDefinedNodesOrder.js"],"sourcesContent":["import Tree from '../../../algorithms/Tree';\r\nimport { AdviserPlacementType } from '../../../enums';\r\n\r\nexport default function UserDefinedNodesOrder() {\r\n\r\n};\r\n\r\nUserDefinedNodesOrder.prototype.getUserDefinedPositions = function (items) {\r\n  var userItem,\r\n    index, len,\r\n    relationTree = Tree(),\r\n    referencedItems = {};\r\n\r\n  for (index = 0, len = items.length; index < len; index += 1) {\r\n    userItem = items[index];\r\n    /* user should define unique id for every FamItemConfig otherwise we ignore it\r\n       user should define relativeItem otherwise we cannot position item\r\n    */\r\n    if (userItem.relativeItem != null) {\r\n      referencedItems[userItem.relativeItem] = true;\r\n    }\r\n    if (userItem.id != null) {\r\n      referencedItems[userItem.id] = true;\r\n    }\r\n  }\r\n\r\n  /* convert items relations into tree, it is not necessary to be a single root tree */\r\n  for (index = 0, len = items.length; index < len; index += 1) {\r\n    userItem = items[index];\r\n    if (referencedItems.hasOwnProperty(userItem.id)) {\r\n      var relativeItem = userItem.relativeItem || null;\r\n      relationTree.add(relativeItem, userItem.id, userItem);\r\n    }\r\n  }\r\n\r\n  /* at this step relationTree should contain some set of root items \r\n    if it has no root items that means we ether don't have any user defined relations\r\n    or relations tree is looped so we ignore loops\r\n  */\r\n  function Set(position, items) {\r\n    this.position = position;\r\n    this.items = items;\r\n  }\r\n\r\n  var itemsOrder = {};\r\n  var lefts = {};\r\n  var rights = {};\r\n  relationTree.loopPostOrder(this, function (nodeid, node, parentid, parent) {\r\n    var items = [],\r\n      leftItems = lefts[nodeid],\r\n      rightItems = rights[nodeid],\r\n      index;\r\n    if (leftItems != null) {\r\n      leftItems.sort(function (a, b) {\r\n        return b.position - a.position\r\n      });\r\n      for (index = 0; index < leftItems.length; index += 1) {\r\n        items = items.concat(leftItems[index].items);\r\n      }\r\n    }\r\n    items.push(nodeid);\r\n    if (rightItems != null) {\r\n      rightItems.sort(function (a, b) {\r\n        return a.position - b.position\r\n      });\r\n      for (index = 0; index < rightItems.length; index += 1) {\r\n        items = items.concat(rightItems[index].items);\r\n      }\r\n    }\r\n\r\n    if (parentid != null) {\r\n      if (node.placementType == AdviserPlacementType.Left) {\r\n        if (!lefts.hasOwnProperty(parentid)) {\r\n          lefts[parentid] = [];\r\n        }\r\n        lefts[parentid].push(new Set(node.position, items));\r\n      } else {\r\n        if (!rights.hasOwnProperty(parentid)) {\r\n          rights[parentid] = [];\r\n        }\r\n        rights[parentid].push(new Set(node.position, items));\r\n      }\r\n    } else {\r\n      itemsOrder[nodeid] = items;\r\n    }\r\n  });\r\n\r\n  /* convert root items collections into a sinle result hash */\r\n  var position = {},\r\n    group = {};\r\n\r\n  for (var rootItemId in itemsOrder) {\r\n    if (itemsOrder.hasOwnProperty(rootItemId)) {\r\n      items = itemsOrder[rootItemId];\r\n      for (index = 0; index < items.length; index += 1) {\r\n        var itemid = items[index];\r\n        position[itemid] = index;\r\n        group[itemid] = rootItemId;\r\n      }\r\n    }\r\n  }\r\n  return {\r\n    position: position,\r\n    group: group\r\n  };\r\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}