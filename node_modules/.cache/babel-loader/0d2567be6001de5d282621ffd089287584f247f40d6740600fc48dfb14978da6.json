{"ast":null,"code":"import Point from './graphics/structs/Point';\nimport Rect from './graphics/structs/Rect';\nimport { UpdateMode, OrientationType } from './enums';\nimport { isNullOrEmpty } from './common';\nimport createGraphics, { isChrome } from './graphics/createGraphics';\nimport { getFixOfPixelAlignment, getInnerSize, getElementOffset } from './graphics/dom';\nimport JsonML from './common/jsonml-html';\nimport { mergeObjects } from './common';\n\n/**\r\n * JavaScript Abstract Control\r\n * @class BaseControl\r\n */\nexport default function BaseControl(element, options, taskManagerFactory, eventArgsFactory, templates) {\n  var _data = {\n      name: \"orgdiagram\",\n      options: options,\n      tasks: null,\n      graphics: null,\n      mouse: null,\n      layout: {\n        element: element,\n        controlPanel: null,\n        frameMousePanel: null,\n        framePlaceholder: null,\n        titlesMousePanel: null,\n        titlesPlaceholder: null,\n        scrollPanel: null,\n        mousePanel: null,\n        placeholder: null,\n        calloutPlaceholder: null,\n        forceCenterOnCursor: true\n      }\n    },\n    _dragFrom,\n    _scrollFrom,\n    _scrollTo,\n    _dragImage,\n    _dragTimer,\n    _debug = false,\n    _timer = null;\n\n  /**\r\n   * Performs full redraw of the diagram contents via reevaluating all API options. This method has to be called explicitly\r\n   * after all options are set in order to update controls contents.\r\n   * \r\n   * @param {UpdateMode} updateMode \r\n   * @param {boolean} forceCenterOnCursor \r\n   */\n  function update(updateMode, forceCenterOnCursor) {\n    if (forceCenterOnCursor == null) {\n      forceCenterOnCursor = true;\n    }\n    switch (updateMode) {\n      case UpdateMode.Refresh:\n        refresh(forceCenterOnCursor, _debug);\n        break;\n      case UpdateMode.PositonHighlight:\n        positionHighlight(_debug);\n        break;\n      default:\n        redraw();\n        break;\n    }\n  }\n\n  /**\r\n   * Removes all elements control added to DOM including event listeners.\r\n   */\n  function destroy() {\n    unbind(_data.layout);\n    cleanLayout(_data.layout);\n    _data.tasks = null;\n    _data.graphics = null;\n  }\n  function redraw() {\n    unbind(_data.layout);\n    cleanLayout(_data.layout);\n    createLayout(_data.layout, _data.name);\n    bind(_data.layout);\n    _data.tasks = taskManagerFactory(getOptions, getGraphics, getLayout, setLayout, templates);\n    _data.graphics = createGraphics(_data.layout.element);\n    _data.graphics.debug = _debug;\n    refresh(true, _debug);\n  }\n  function refresh(forceCenterOnCursor, debug) {\n    var centerOnCursorTask, placeholderOffset;\n\n    //_data.layout.scrollPanel.css({\n    //  \"display\": \"none\",\n    //  \"-webkit-overflow-scrolling\": \"auto\"\n    //});\n\n    //this.graphics.begin();\n\n    _data.layout.forceCenterOnCursor = forceCenterOnCursor;\n    _data.tasks.process('OptionsTask', null, debug);\n    _data.graphics.end();\n\n    //_data.layout.scrollPanel.css({\n    //  \"display\": \"block\"\n    //});\n\n    if (forceCenterOnCursor) {\n      /* scroll to offset */\n      centerOnCursorTask = _data.tasks.getTask(\"CenterOnCursorTask\");\n      placeholderOffset = centerOnCursorTask.getPlaceholderOffset();\n      _data.layout.scrollPanel.scrollLeft = placeholderOffset.x;\n      _data.layout.scrollPanel.scrollTop = placeholderOffset.y;\n    }\n    //_data.layout.scrollPanel.css({\n    //  \"-webkit-overflow-scrolling\": \"touch\"\n    //});\n\n    /* fix pixel alignment */\n    var pixelAlignmentFix = getFixOfPixelAlignment(_data.layout.element);\n    JsonML.applyStyles(_data.layout.scrollPanel, {\n      \"marginBottom\": \"0px\",\n      \"marginRight\": \"0px\",\n      \"marginLeft\": pixelAlignmentFix.width + \"px\",\n      /* fixes div pixel alignment */\n      \"marginTop\": pixelAlignmentFix.height + \"px\"\n    });\n  }\n  function positionHighlight(debug) {\n    _data.layout.forceCenterOnCursor = false;\n    _data.tasks.process('HighlightItemOptionTask', null, debug);\n    _data.graphics.end();\n  }\n  function redrawCurrentViewPort(debug) {\n    _data.layout.forceCenterOnCursor = false;\n    _data.tasks.process('LayoutOptionsTask', null, debug);\n    _data.graphics.end();\n  }\n  function onScroll(event) {\n    if (_timer == null) {\n      _timer = window.setTimeout(function () {\n        redrawCurrentViewPort(_debug);\n        window.clearTimeout(_timer);\n        _timer = null;\n      }, 200);\n    }\n  }\n\n  /**\r\n   * Call this method to update controls configuration. Control uses default Config instance to initialize itself, \r\n   * so it sets only options provided in the options parameter.\r\n   * \r\n   * @param {object} options Options\r\n   */\n  function setOptions(options) {\n    for (var option in options) {\n      if (options.hasOwnProperty(option)) {\n        _data.options[option] = options[option];\n      }\n    }\n  }\n\n  /**\r\n   * This method returns current configuration object.\r\n   * \r\n   * @returns {object} Returns reference to current configuration object\r\n   */\n  function getOptions() {\n    return _data.options;\n  }\n\n  /**\r\n   * This method returns configuration option by name.\r\n   * \r\n   * @param {*} option Option name\r\n   */\n  function getOption(option) {\n    return _data.options[option];\n  }\n\n  /**\r\n   * Sets configuration option of the control by name.\r\n   * \r\n   * @param {*} option Option name\r\n   * @param {*} value Option value\r\n   */\n  function setOption(option, value) {\n    return _data.options[option] = value;\n  }\n  function getGraphics() {\n    return _data.graphics;\n  }\n  function getLayout() {\n    var layout = _data.layout,\n      scrollPanelSize = getInnerSize(layout.controlPanel),\n      placeholderOffset = new Point(layout.scrollPanel.scrollLeft, layout.scrollPanel.scrollTop);\n    return {\n      forceCenterOnCursor: layout.forceCenterOnCursor,\n      scrollPanelSize: scrollPanelSize,\n      placeholderOffset: placeholderOffset\n    };\n  }\n  function setLayout(layoutOptions) {\n    var layout = _data.layout,\n      pixelAlignmentFix = getFixOfPixelAlignment(layout.element);\n    JsonML.applyStyles(layout.controlPanel, {\n      \"marginLeft\": pixelAlignmentFix.width + \"px\",\n      /* fixes div pixel alignment */\n      \"marginTop\": pixelAlignmentFix.height + \"px\"\n    });\n\n    /* set scroll panel position */\n    JsonML.applyStyles(layout.scrollPanel, layoutOptions.scrollPanelRect.getCSS());\n\n    /* set scaled content panel for tracking mouse events without scaling */\n    JsonML.applyStyles(layout.mousePanel, layoutOptions.mousePanelSize.getCSS());\n\n    /* set size and scale of content panel */\n    var scaleText = \"scale(\" + layoutOptions.scale + \",\" + layoutOptions.scale + \")\";\n    var scaleProperties = {\n      \"transform-origin\": \"0 0\",\n      \"transform\": scaleText,\n      \"-ms-transform\": scaleText,\n      /* IE 9 */\n      \"-webkit-transform\": scaleText,\n      /* Safari and Chrome */\n      \"-o-transform\": scaleText,\n      /* Opera */\n      \"-moz-transform\": scaleText /* Firefox */\n    };\n    JsonML.applyStyles(layout.placeholder, mergeObjects(scaleProperties, layoutOptions.placeholderSize.getCSS()));\n    if (layoutOptions.autoSize) {\n      /* resize element to fit placeholder if control in auto size mode */\n      JsonML.applyStyles(layout.element, layoutOptions.controlSize.getCSS());\n    }\n\n    /* set titles panel scale and size */\n    JsonML.applyStyles(layout.titlesMousePanel, layoutOptions.titlesMousePanelRect.getCSS());\n    JsonML.applyStyles(layout.titlesPlaceholder, mergeObjects(scaleProperties, layoutOptions.titlesPlaceholderSize.getCSS()));\n\n    /* set frame panel scale and size */\n    JsonML.applyStyles(layout.frameMousePanel, layoutOptions.frameMousePanelRect.getCSS());\n    JsonML.applyStyles(layout.framePlaceholder, mergeObjects(scaleProperties, layoutOptions.framePlaceholderSize.getCSS()));\n    layout.scrollPanel.setAttribute(\"class\", layoutOptions.scrollPanelRect.left > 0 ? name : \"bp-scrollframe \" + name);\n  }\n  function createLayout(layout, name) {\n    var viewportSize = getInnerSize(layout.element),\n      viewportRect = new Rect(0, 0, viewportSize.width, viewportSize.height),\n      pixelAlignmentFix = getFixOfPixelAlignment(element);\n    JsonML.appendDOM(layout.element, JsonML.toHTML([\"div\", /* root control panel */\n    {\n      \"tabindex\": 0,\n      \"style\": {\n        \"position\": \"relative\",\n        \"overflow\": \"hidden\",\n        \"top\": \"0px\",\n        \"left\": \"0px\",\n        \"width\": \"100%\",\n        \"height\": \"100%\",\n        \"padding\": \"0px\",\n        \"marginBottom\": \"0px\",\n        \"marginRight\": \"0px\",\n        \"marginLeft\": pixelAlignmentFix.width + \"px\",\n        /* fixes div pixel alignment */\n        \"marginTop\": pixelAlignmentFix.height + \"px\"\n      },\n      \"name\": \"controlPanel\",\n      \"class\": name,\n      \"$\": function (element) {\n        layout.controlPanel = element;\n      }\n    }, [\"div\", /* frameMousePanel - frame mouse tracking events panel */\n    {\n      \"style\": mergeObjects({\n        position: \"absolute\",\n        overflow: \"hidden\"\n      }, viewportRect.getCSS()),\n      \"name\": \"frameMousePanel\",\n      \"class\": name,\n      \"$\": function (element) {\n        layout.frameMousePanel = element;\n      }\n    }, [\"div\", /* frameplaceholder - contents scalable panel */\n    {\n      \"style\": mergeObjects({\n        position: \"absolute\",\n        overflow: \"hidden\"\n      }, viewportRect.getCSS()),\n      \"name\": \"framePlaceholder\",\n      \"class\": [\"frameplaceholder\", name],\n      \"$\": function (element) {\n        layout.framePlaceholder = element;\n      }\n    }]], [\"div\", /* titlesMousePanel - titles mouse tracking events panel */\n    {\n      \"style\": mergeObjects({\n        position: \"absolute\",\n        overflow: \"hidden\"\n      }, viewportRect.getCSS()),\n      \"name\": \"titlesMousePanel\",\n      \"class\": [\"bp-titles-frame\", name],\n      \"$\": function (element) {\n        layout.titlesMousePanel = element;\n      }\n    }, [\"div\", /* titlesplaceholder - contents scalable panel */\n    {\n      \"style\": mergeObjects({\n        position: \"absolute\",\n        overflow: \"hidden\"\n      }, viewportRect.getCSS()),\n      \"name\": \"titlesPlaceholder\",\n      \"class\": [\"titlesplaceholder\", name],\n      \"$\": function (element) {\n        layout.titlesPlaceholder = element;\n      }\n    }]], [\"div\", /* scrollPanel - root scroll panel */\n    {\n      \"style\": mergeObjects({\n        position: \"absolute\",\n        \"overflow\": \"auto\",\n        \"-webkit-overflow-scrolling\": \"touch\",\n        \"top\": \"0px\",\n        \"left\": \"0px\",\n        \"width\": viewportRect.width + \"px\",\n        \"height\": viewportRect.height + \"px\"\n      }, viewportRect.getCSS()),\n      \"name\": \"scrollPanel\",\n      \"class\": name,\n      \"$\": function (element) {\n        layout.scrollPanel = element;\n      }\n    }, [\"div\", /* mousePanel - mouse tracking events panel */\n    {\n      \"style\": mergeObjects({\n        position: \"absolute\",\n        overflow: \"visible\"\n      }, viewportRect.getCSS()),\n      \"name\": \"mousePanel\",\n      \"class\": name,\n      \"$\": function (element) {\n        layout.mousePanel = element;\n      }\n    }, [\"div\", /* placeholder - contents scalable panel */\n    {\n      \"style\": mergeObjects({\n        position: \"absolute\",\n        overflow: \"hidden\"\n      }, viewportRect.getCSS()),\n      \"name\": \"placeholder\",\n      \"class\": [\"placeholder\", name],\n      \"$\": function (element) {\n        layout.placeholder = element;\n      }\n    }, [\"div\", /* calloutPlaceholder - callout panel */\n    {\n      \"style\": {\n        position: \"absolute\",\n        overflow: \"visible\",\n        top: \"0px\",\n        left: \"0px\",\n        width: \"0px\",\n        height: \"0px\"\n      },\n      \"name\": \"calloutPlaceholder\",\n      \"class\": [\"calloutplaceholder\", name],\n      \"$\": function (element) {\n        layout.calloutPlaceholder = element;\n      }\n    }]]]]]));\n  }\n  function cleanLayout() {\n    var controlPanel = _data.layout.controlPanel;\n    if (controlPanel != null) {\n      var parent = controlPanel.parentNode;\n      if (parent != null) {\n        parent.removeChild(controlPanel);\n      }\n    }\n  }\n  function bind(layout) {\n    layout.mousePanel.addEventListener('mousemove', onMouseMove);\n    layout.mousePanel.addEventListener('click', onMouseClick);\n    layout.mousePanel.addEventListener('dblclick', onMouseDblClick);\n    layout.mousePanel.addEventListener('change', onCheckboxChange);\n    layout.element.addEventListener('keydown', onKeyDown);\n    layout.scrollPanel.addEventListener('scroll', onScroll);\n    if (_data.options.enablePanning && isChrome()) {\n      layout.scrollPanel.draggable = true;\n      layout.scrollPanel.addEventListener('dragstart', onDragStart);\n      layout.scrollPanel.addEventListener('drag', onDragScroll);\n      layout.scrollPanel.addEventListener('dragend', onDragScroll);\n      layout.scrollPanel.addEventListener('dragover', onDragOver);\n    }\n    layout.frameMousePanel.addEventListener('mousemove', onFrameMouseMove);\n    layout.frameMousePanel.addEventListener('click', onFrameMouseClick);\n  }\n  function unbind(layout) {\n    if (layout.mousePanel != null) {\n      layout.mousePanel.removeEventListener(\"mousemove\", onMouseMove);\n      layout.mousePanel.removeEventListener(\"click\", onMouseClick);\n      layout.mousePanel.removeEventListener(\"dblclick\", onMouseDblClick);\n      layout.mousePanel.removeEventListener(\"change\", onCheckboxChange);\n    }\n    if (layout.element != null) {\n      layout.element.removeEventListener(\"keydown\", onKeyDown);\n    }\n    if (layout.scrollPanel != null) {\n      layout.scrollPanel.removeEventListener(\"scroll\", onScroll);\n      layout.scrollPanel.removeEventListener('dragstart', onDragStart);\n      layout.scrollPanel.removeEventListener('drag', onDragScroll);\n      layout.scrollPanel.removeEventListener('dragend', onDragScroll);\n      layout.scrollPanel.removeEventListener('dragover', onDragOver);\n    }\n    if (layout.frameMousePanel != null) {\n      layout.frameMousePanel.removeEventListener('mousemove', onFrameMouseMove);\n      layout.frameMousePanel.removeEventListener('click', onFrameMouseClick);\n    }\n  }\n  function onFrameMouseMove(event) {\n    var placeholderOffset = getElementOffset(_data.layout.frameMousePanel),\n      x = event.pageX - placeholderOffset.left,\n      y = event.pageY - placeholderOffset.top;\n    var projectItemsToFrameTask = _data.tasks.getTask(\"ProjectItemsToFrameTask\"),\n      highlightItemOptionTask = _data.tasks.getTask(\"HighlightItemOptionTask\"),\n      itemId;\n    if (highlightItemOptionTask.hasHighlightEnabled()) {\n      itemId = projectItemsToFrameTask.getTreeItemForMousePosition(x, y, highlightItemOptionTask.getGravityRadius());\n      setHighlightItem(event, itemId);\n    }\n  }\n  function onFrameMouseClick(event) {\n    var placeholderOffset = getElementOffset(_data.layout.frameMousePanel),\n      x = event.pageX - placeholderOffset.left,\n      y = event.pageY - placeholderOffset.top,\n      projectItemsToFrameTask = _data.tasks.getTask(\"ProjectItemsToFrameTask\"),\n      cursorItemOptionTask = _data.tasks.getTask(\"CursorItemOptionTask\"),\n      highlightItemOptionTask = _data.tasks.getTask(\"HighlightItemOptionTask\"),\n      newCursorItemId = projectItemsToFrameTask.getTreeItemForMousePosition(x, y, highlightItemOptionTask.getGravityRadius()),\n      target,\n      eventArgs;\n    target = event.target;\n    if (newCursorItemId !== null) {\n      eventArgs = getEventArgs(null, newCursorItemId);\n      trigger(\"onMouseClick\", event, eventArgs);\n      if (!eventArgs.cancel) {\n        if (cursorItemOptionTask.hasCursorEnabled()) {\n          setCursorItem(event, newCursorItemId);\n          _data.layout.element.focus();\n        }\n      }\n    }\n  }\n  function onMouseMove(event) {\n    var placeholderOffset = getElementOffset(_data.layout.mousePanel),\n      x = event.pageX - placeholderOffset.left,\n      y = event.pageY - placeholderOffset.top,\n      createTransformTask = _data.tasks.getTask(\"CreateTransformTask\"),\n      highlightItemOptionTask = _data.tasks.getTask(\"HighlightItemOptionTask\"),\n      itemId;\n    if (highlightItemOptionTask.hasHighlightEnabled()) {\n      itemId = createTransformTask.getTreeItemForMousePosition(x, y, highlightItemOptionTask.getGravityRadius());\n      setHighlightItem(event, itemId);\n    }\n  }\n  function onCheckboxChange(event) {\n    var target = event.target;\n    var selectedId = target.getAttribute(\"data-id\");\n    if (selectedId != null) {\n      var selectedItems = (_data.options.selectedItems || []).slice();\n      var eventArgs = getEventArgs(null, selectedId);\n      var position = selectedItems.findIndex(function (itemid) {\n        return selectedId == itemid;\n      });\n      trigger(\"onSelectionChanging\", event, eventArgs);\n      if (!eventArgs.cancel) {\n        if (position >= 0) {\n          selectedItems.splice(position, 1);\n        } else {\n          selectedItems.push(selectedId);\n        }\n        _data.options.selectedItems = selectedItems;\n        if (position < 0) {\n          target.setAttribute(\"checked\", \"checked\");\n        } else {\n          target.removeAttribute(\"checked\");\n        }\n\n        //refresh(false, false);\n\n        trigger(\"onSelectionChanged\", event, eventArgs);\n      }\n    }\n  }\n  function onMouseClick(event) {\n    var placeholderOffset = getElementOffset(_data.layout.mousePanel),\n      x = event.pageX - placeholderOffset.left,\n      y = event.pageY - placeholderOffset.top,\n      createTransformTask = _data.tasks.getTask(\"CreateTransformTask\"),\n      cursorItemOptionTask = _data.tasks.getTask(\"CursorItemOptionTask\"),\n      highlightItemOptionTask = _data.tasks.getTask(\"HighlightItemOptionTask\"),\n      newCursorItemId = createTransformTask.getTreeItemForMousePosition(x, y, highlightItemOptionTask.getGravityRadius()),\n      target,\n      buttonName,\n      eventArgs;\n    target = event.target;\n    if (newCursorItemId !== null) {\n      var buttonName = target.getAttribute(\"data-buttonname\");\n      if (isNullOrEmpty(buttonName)) {\n        buttonName = target.parentNode && target.parentNode.getAttribute(\"data-buttonname\");\n      }\n      ;\n      if (!isNullOrEmpty(buttonName)) {\n        eventArgs = getEventArgs(null, newCursorItemId, buttonName);\n        trigger(\"onButtonClick\", event, eventArgs);\n      } else if (target.getAttribute(\"name\") === \"checkbox\" || target.getAttribute(\"name\") === \"selectiontext\") {} else {\n        eventArgs = getEventArgs(null, newCursorItemId);\n        trigger(\"onMouseClick\", event, eventArgs);\n        if (!eventArgs.cancel) {\n          if (cursorItemOptionTask.hasCursorEnabled()) {\n            setCursorItem(event, newCursorItemId);\n            _data.layout.element.focus();\n          }\n        }\n      }\n    }\n  }\n  function onMouseDblClick(event) {\n    var eventArgs,\n      highlightItemTask = _data.tasks.getTask(\"HighlightItemTask\"),\n      highlightTreeItem = highlightItemTask.getHighlightTreeItem();\n    if (highlightTreeItem !== null) {\n      eventArgs = getEventArgs(null, highlightTreeItem);\n      trigger(\"onMouseDblClick\", event, eventArgs);\n    }\n  }\n  function onKeyDown(event) {\n    var highlightItemTask = _data.tasks.getTask(\"HighlightItemTask\"),\n      highlightItemOptionTask = _data.tasks.getTask(\"HighlightItemOptionTask\"),\n      cursorItemTask = _data.tasks.getTask(\"CursorItemTask\"),\n      cursorItemOptionTask = _data.tasks.getTask(\"CursorItemOptionTask\"),\n      alignDiagramTask = _data.tasks.getTask('AlignDiagramTask'),\n      createTransformTask = _data.tasks.getTask('CreateTransformTask'),\n      transform = createTransformTask.getTransform(),\n      navigationItem = null,\n      newNavigationItem,\n      direction = null,\n      accepted,\n      layout = _data.layout;\n    if (highlightItemOptionTask.hasHighlightEnabled() && cursorItemOptionTask.hasCursorEnabled()) {\n      navigationItem = highlightItemTask.getHighlightTreeItem();\n      if (navigationItem === null) {\n        navigationItem = cursorItemTask.getCursorTreeItem();\n      }\n    } else if (highlightItemOptionTask.hasHighlightEnabled()) {\n      navigationItem = highlightItemTask.getHighlightTreeItem();\n    } else if (cursorItemOptionTask.hasCursorEnabled()) {\n      navigationItem = cursorItemTask.getCursorTreeItem();\n    }\n    if (navigationItem != null) {\n      switch (event.which) {\n        case 13:\n          /*Enter*/\n          if (cursorItemOptionTask.hasCursorEnabled()) {\n            setCursorItem(event, navigationItem);\n            event.preventDefault();\n            layout.element.focus();\n          }\n          break;\n        case 40:\n          /*Down*/\n          direction = OrientationType.Bottom;\n          break;\n        case 38:\n          /*Up*/\n          direction = OrientationType.Top;\n          break;\n        case 37:\n          /*Left*/\n          direction = OrientationType.Left;\n          break;\n        case 39:\n          /*Right*/\n          direction = OrientationType.Right;\n          break;\n      }\n      if (direction != null) {\n        accepted = false;\n        while (!accepted) {\n          accepted = true;\n          direction = transform.getOrientation(direction);\n          newNavigationItem = alignDiagramTask.getNextItem(navigationItem, direction);\n          if (newNavigationItem != null) {\n            event.preventDefault();\n            if (highlightItemOptionTask.hasHighlightEnabled()) {\n              setHighlightItem(event, newNavigationItem);\n            } else if (cursorItemOptionTask.hasCursorEnabled()) {\n              setCursorItem(event, newNavigationItem);\n            }\n          }\n        }\n        layout.element.focus();\n      }\n    }\n  }\n  function onDragStart(event) {\n    var scrollPanel = _data.layout.scrollPanel;\n    _dragFrom = new Point(event.clientX, event.clientY);\n    _scrollFrom = new Point(scrollPanel.scrollLeft, scrollPanel.scrollTop);\n    _dragImage = _dragImage || new Image();\n    event.dataTransfer.setDragImage(_dragImage, 0, 0);\n  }\n  function onDragOver(event) {\n    event.preventDefault();\n    event.dataTransfer.dropEffect = \"move\";\n  }\n  function onDragScroll(event) {\n    _scrollTo = new Point(_scrollFrom.x - (event.clientX - _dragFrom.x), _scrollFrom.y - (event.clientY - _dragFrom.y));\n    if (_dragTimer == null) {\n      _dragTimer = window.setTimeout(function () {\n        var scrollPanel = _data.layout.scrollPanel;\n        scrollPanel.scrollLeft = _scrollTo.x;\n        scrollPanel.scrollTop = _scrollTo.y;\n        window.clearTimeout(_dragTimer);\n        _dragTimer = null;\n      }, 50);\n    }\n  }\n  function setHighlightItem(event, newHighlightItemId) {\n    var result = true,\n      eventArgs;\n    if (newHighlightItemId !== null) {\n      if (newHighlightItemId !== _data.options.highlightItem) {\n        eventArgs = getEventArgs(_data.options.highlightItem, newHighlightItemId);\n        _data.options.highlightItem = newHighlightItemId;\n        trigger(\"onHighlightChanging\", event, eventArgs);\n        if (!eventArgs.cancel) {\n          refresh(false, false);\n          trigger(\"onHighlightChanged\", event, eventArgs);\n        } else {\n          result = false;\n        }\n      }\n    } else {\n      if (_data.options.highlightItem !== null) {\n        eventArgs = getEventArgs(_data.options.highlightItem, null);\n        _data.options.highlightItem = null;\n        trigger(\"onHighlightChanging\", event, eventArgs);\n        if (!eventArgs.cancel) {\n          refresh(false, false);\n          trigger(\"onHighlightChanged\", event, eventArgs);\n        } else {\n          result = false;\n        }\n      }\n    }\n    return result;\n  }\n  function setCursorItem(event, newCursorItemId) {\n    var eventArgs;\n    if (newCursorItemId !== _data.options.cursorItem) {\n      eventArgs = getEventArgs(_data.options.cursorItem, newCursorItemId);\n      _data.options.cursorItem = newCursorItemId;\n      trigger(\"onCursorChanging\", event, eventArgs);\n      if (!eventArgs.cancel) {\n        refresh(true, _debug);\n        trigger(\"onCursorChanged\", event, eventArgs);\n      }\n    }\n  }\n  function getEventArgs(oldTreeItemId, newTreeItemId, name) {\n    return eventArgsFactory(_data, oldTreeItemId, newTreeItemId, name);\n  }\n  function trigger(eventHandlerName, event, eventArgs) {\n    var eventHandler = _data.options[eventHandlerName];\n    if (eventHandler != null) {\n      eventHandler(event, eventArgs);\n    }\n  }\n  update(); /* init control on create */\n\n  return {\n    destroy: destroy,\n    setOptions: setOptions,\n    getOptions: getOptions,\n    setOption: setOption,\n    getOption: getOption,\n    update: update\n  };\n}\n;","map":{"version":3,"names":["Point","Rect","UpdateMode","OrientationType","isNullOrEmpty","createGraphics","isChrome","getFixOfPixelAlignment","getInnerSize","getElementOffset","JsonML","mergeObjects","BaseControl","element","options","taskManagerFactory","eventArgsFactory","templates","_data","name","tasks","graphics","mouse","layout","controlPanel","frameMousePanel","framePlaceholder","titlesMousePanel","titlesPlaceholder","scrollPanel","mousePanel","placeholder","calloutPlaceholder","forceCenterOnCursor","_dragFrom","_scrollFrom","_scrollTo","_dragImage","_dragTimer","_debug","_timer","update","updateMode","Refresh","refresh","PositonHighlight","positionHighlight","redraw","destroy","unbind","cleanLayout","createLayout","bind","getOptions","getGraphics","getLayout","setLayout","debug","centerOnCursorTask","placeholderOffset","process","end","getTask","getPlaceholderOffset","scrollLeft","x","scrollTop","y","pixelAlignmentFix","applyStyles","width","height","redrawCurrentViewPort","onScroll","event","window","setTimeout","clearTimeout","setOptions","option","hasOwnProperty","getOption","setOption","value","scrollPanelSize","layoutOptions","scrollPanelRect","getCSS","mousePanelSize","scaleText","scale","scaleProperties","placeholderSize","autoSize","controlSize","titlesMousePanelRect","titlesPlaceholderSize","frameMousePanelRect","framePlaceholderSize","setAttribute","left","viewportSize","viewportRect","appendDOM","toHTML","$","position","overflow","top","parent","parentNode","removeChild","addEventListener","onMouseMove","onMouseClick","onMouseDblClick","onCheckboxChange","onKeyDown","enablePanning","draggable","onDragStart","onDragScroll","onDragOver","onFrameMouseMove","onFrameMouseClick","removeEventListener","pageX","pageY","projectItemsToFrameTask","highlightItemOptionTask","itemId","hasHighlightEnabled","getTreeItemForMousePosition","getGravityRadius","setHighlightItem","cursorItemOptionTask","newCursorItemId","target","eventArgs","getEventArgs","trigger","cancel","hasCursorEnabled","setCursorItem","focus","createTransformTask","selectedId","getAttribute","selectedItems","slice","findIndex","itemid","splice","push","removeAttribute","buttonName","highlightItemTask","highlightTreeItem","getHighlightTreeItem","cursorItemTask","alignDiagramTask","transform","getTransform","navigationItem","newNavigationItem","direction","accepted","getCursorTreeItem","which","preventDefault","Bottom","Top","Left","Right","getOrientation","getNextItem","clientX","clientY","Image","dataTransfer","setDragImage","dropEffect","newHighlightItemId","result","highlightItem","cursorItem","oldTreeItemId","newTreeItemId","eventHandlerName","eventHandler"],"sources":["/Users/iamnestyyy/ReactProjects/orgchart/node_modules/basicprimitives/src/BaseControl.js"],"sourcesContent":["import Point from './graphics/structs/Point';\r\nimport Rect from './graphics/structs/Rect';\r\nimport { UpdateMode, OrientationType } from './enums';\r\nimport { isNullOrEmpty } from './common';\r\nimport createGraphics, { isChrome } from './graphics/createGraphics';\r\nimport { getFixOfPixelAlignment, getInnerSize, getElementOffset } from './graphics/dom';\r\nimport JsonML from './common/jsonml-html';\r\nimport { mergeObjects } from './common';\r\n\r\n/**\r\n * JavaScript Abstract Control\r\n * @class BaseControl\r\n */\r\nexport default function BaseControl(element, options, taskManagerFactory, eventArgsFactory, templates) {\r\n  var _data = {\r\n    name: \"orgdiagram\",\r\n    options: options,\r\n    tasks: null,\r\n    graphics: null,\r\n    mouse: null,\r\n    layout: {\r\n      element: element,\r\n      controlPanel: null,\r\n      frameMousePanel: null,\r\n      framePlaceholder: null,\r\n      titlesMousePanel: null,\r\n      titlesPlaceholder: null,\r\n      scrollPanel: null,\r\n      mousePanel: null,\r\n      placeholder: null,\r\n      calloutPlaceholder: null,\r\n      forceCenterOnCursor: true\r\n    }\r\n  },\r\n    _dragFrom,\r\n    _scrollFrom,\r\n    _scrollTo,\r\n    _dragImage,\r\n    _dragTimer,\r\n    _debug = false,\r\n    _timer = null;\r\n\r\n  /**\r\n   * Performs full redraw of the diagram contents via reevaluating all API options. This method has to be called explicitly\r\n   * after all options are set in order to update controls contents.\r\n   * \r\n   * @param {UpdateMode} updateMode \r\n   * @param {boolean} forceCenterOnCursor \r\n   */\r\n  function update(updateMode, forceCenterOnCursor) {\r\n    if (forceCenterOnCursor == null) {\r\n      forceCenterOnCursor = true;\r\n    }\r\n    switch (updateMode) {\r\n      case UpdateMode.Refresh:\r\n        refresh(forceCenterOnCursor, _debug);\r\n        break;\r\n      case UpdateMode.PositonHighlight:\r\n        positionHighlight(_debug);\r\n        break;\r\n      default:\r\n        redraw();\r\n        break;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Removes all elements control added to DOM including event listeners.\r\n   */\r\n  function destroy() {\r\n    unbind(_data.layout);\r\n    cleanLayout(_data.layout);\r\n\r\n    _data.tasks = null;\r\n    _data.graphics = null;\r\n  }\r\n\r\n  function redraw() {\r\n    unbind(_data.layout);\r\n    cleanLayout(_data.layout);\r\n\r\n    createLayout(_data.layout, _data.name);\r\n    bind(_data.layout);\r\n    _data.tasks = taskManagerFactory(getOptions, getGraphics, getLayout, setLayout, templates);\r\n    _data.graphics = createGraphics(_data.layout.element);\r\n    _data.graphics.debug = _debug;\r\n\r\n    refresh(true, _debug);\r\n  }\r\n\r\n  function refresh(forceCenterOnCursor, debug) {\r\n    var centerOnCursorTask,\r\n      placeholderOffset;\r\n\r\n    //_data.layout.scrollPanel.css({\r\n    //  \"display\": \"none\",\r\n    //  \"-webkit-overflow-scrolling\": \"auto\"\r\n    //});\r\n\r\n    //this.graphics.begin();\r\n\r\n    _data.layout.forceCenterOnCursor = forceCenterOnCursor;\r\n    _data.tasks.process('OptionsTask', null, debug);\r\n\r\n    _data.graphics.end();\r\n\r\n    //_data.layout.scrollPanel.css({\r\n    //  \"display\": \"block\"\r\n    //});\r\n\r\n    if (forceCenterOnCursor) {\r\n      /* scroll to offset */\r\n      centerOnCursorTask = _data.tasks.getTask(\"CenterOnCursorTask\");\r\n      placeholderOffset = centerOnCursorTask.getPlaceholderOffset();\r\n      _data.layout.scrollPanel.scrollLeft = placeholderOffset.x;\r\n      _data.layout.scrollPanel.scrollTop = placeholderOffset.y;\r\n    }\r\n    //_data.layout.scrollPanel.css({\r\n    //  \"-webkit-overflow-scrolling\": \"touch\"\r\n    //});\r\n\r\n    /* fix pixel alignment */\r\n    var pixelAlignmentFix = getFixOfPixelAlignment(_data.layout.element);\r\n    JsonML.applyStyles(_data.layout.scrollPanel, {\r\n      \"marginBottom\": \"0px\",\r\n      \"marginRight\": \"0px\",\r\n      \"marginLeft\": pixelAlignmentFix.width + \"px\", /* fixes div pixel alignment */\r\n      \"marginTop\": pixelAlignmentFix.height + \"px\"\r\n    });\r\n  }\r\n\r\n  function positionHighlight(debug) {\r\n    _data.layout.forceCenterOnCursor = false;\r\n    _data.tasks.process('HighlightItemOptionTask', null, debug);\r\n\r\n    _data.graphics.end();\r\n  }\r\n\r\n  function redrawCurrentViewPort(debug) {\r\n    _data.layout.forceCenterOnCursor = false;\r\n    _data.tasks.process('LayoutOptionsTask', null, debug);\r\n\r\n    _data.graphics.end();\r\n  }\r\n\r\n  function onScroll(event) {\r\n    if (_timer == null) {\r\n      _timer = window.setTimeout(function () {\r\n        redrawCurrentViewPort(_debug);\r\n        window.clearTimeout(_timer);\r\n        _timer = null;\r\n      }, 200);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Call this method to update controls configuration. Control uses default Config instance to initialize itself, \r\n   * so it sets only options provided in the options parameter.\r\n   * \r\n   * @param {object} options Options\r\n   */\r\n  function setOptions(options) {\r\n    for (var option in options) {\r\n      if (options.hasOwnProperty(option)) {\r\n        _data.options[option] = options[option];\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * This method returns current configuration object.\r\n   * \r\n   * @returns {object} Returns reference to current configuration object\r\n   */\r\n  function getOptions() {\r\n    return _data.options;\r\n  }\r\n\r\n  /**\r\n   * This method returns configuration option by name.\r\n   * \r\n   * @param {*} option Option name\r\n   */\r\n  function getOption(option) {\r\n    return _data.options[option];\r\n  }\r\n\r\n  /**\r\n   * Sets configuration option of the control by name.\r\n   * \r\n   * @param {*} option Option name\r\n   * @param {*} value Option value\r\n   */\r\n  function setOption(option, value) {\r\n    return _data.options[option] = value;\r\n  }\r\n\r\n  function getGraphics() {\r\n    return _data.graphics;\r\n  }\r\n\r\n  function getLayout() {\r\n    var layout = _data.layout,\r\n      scrollPanelSize = getInnerSize(layout.controlPanel),\r\n      placeholderOffset = new Point(layout.scrollPanel.scrollLeft, layout.scrollPanel.scrollTop);\r\n    return {\r\n      forceCenterOnCursor: layout.forceCenterOnCursor,\r\n      scrollPanelSize: scrollPanelSize,\r\n      placeholderOffset: placeholderOffset\r\n    }\r\n  }\r\n\r\n  function setLayout(layoutOptions) {\r\n    var layout = _data.layout,\r\n      pixelAlignmentFix = getFixOfPixelAlignment(layout.element);\r\n\r\n    JsonML.applyStyles(layout.controlPanel, {\r\n      \"marginLeft\": pixelAlignmentFix.width + \"px\", /* fixes div pixel alignment */\r\n      \"marginTop\": pixelAlignmentFix.height + \"px\"\r\n    });\r\n\r\n    /* set scroll panel position */\r\n    JsonML.applyStyles(layout.scrollPanel, layoutOptions.scrollPanelRect.getCSS());\r\n\r\n    /* set scaled content panel for tracking mouse events without scaling */\r\n    JsonML.applyStyles(layout.mousePanel, layoutOptions.mousePanelSize.getCSS());\r\n\r\n    /* set size and scale of content panel */\r\n    var scaleText = \"scale(\" + layoutOptions.scale + \",\" + layoutOptions.scale + \")\";\r\n    var scaleProperties = {\r\n      \"transform-origin\": \"0 0\",\r\n      \"transform\": scaleText,\r\n      \"-ms-transform\": scaleText, /* IE 9 */\r\n      \"-webkit-transform\": scaleText, /* Safari and Chrome */\r\n      \"-o-transform\": scaleText, /* Opera */\r\n      \"-moz-transform\": scaleText /* Firefox */\r\n    };\r\n    JsonML.applyStyles(layout.placeholder, mergeObjects(scaleProperties, layoutOptions.placeholderSize.getCSS()));\r\n\r\n    if (layoutOptions.autoSize) {\r\n      /* resize element to fit placeholder if control in auto size mode */\r\n      JsonML.applyStyles(layout.element, layoutOptions.controlSize.getCSS());\r\n    }\r\n\r\n    /* set titles panel scale and size */\r\n    JsonML.applyStyles(layout.titlesMousePanel, layoutOptions.titlesMousePanelRect.getCSS());\r\n    JsonML.applyStyles(layout.titlesPlaceholder, mergeObjects(scaleProperties, layoutOptions.titlesPlaceholderSize.getCSS()));\r\n\r\n    /* set frame panel scale and size */\r\n    JsonML.applyStyles(layout.frameMousePanel, layoutOptions.frameMousePanelRect.getCSS());\r\n    JsonML.applyStyles(layout.framePlaceholder, mergeObjects(scaleProperties, layoutOptions.framePlaceholderSize.getCSS()));\r\n    \r\n    layout.scrollPanel.setAttribute(\"class\", layoutOptions.scrollPanelRect.left > 0 ? name : \"bp-scrollframe \" + name);\r\n  }\r\n\r\n  function createLayout(layout, name) {\r\n    var viewportSize = getInnerSize(layout.element),\r\n      viewportRect = new Rect(0, 0, viewportSize.width, viewportSize.height),\r\n      pixelAlignmentFix = getFixOfPixelAlignment(element);\r\n\r\n\r\n    JsonML.appendDOM(layout.element, JsonML.toHTML(\r\n      [\"div\", /* root control panel */\r\n        {\r\n          \"tabindex\": 0,\r\n          \"style\": {\r\n            \"position\": \"relative\",\r\n            \"overflow\": \"hidden\",\r\n            \"top\": \"0px\",\r\n            \"left\": \"0px\",\r\n            \"width\": \"100%\",\r\n            \"height\": \"100%\",\r\n            \"padding\": \"0px\",\r\n            \"marginBottom\": \"0px\",\r\n            \"marginRight\": \"0px\",\r\n            \"marginLeft\": pixelAlignmentFix.width + \"px\", /* fixes div pixel alignment */\r\n            \"marginTop\": pixelAlignmentFix.height + \"px\"\r\n          },\r\n          \"name\": \"controlPanel\",\r\n          \"class\": name,\r\n          \"$\": function (element) { layout.controlPanel = element; }\r\n        },\r\n        [\"div\", /* frameMousePanel - frame mouse tracking events panel */\r\n          {\r\n            \"style\": mergeObjects({\r\n              position: \"absolute\",\r\n              overflow: \"hidden\"\r\n            },\r\n              viewportRect.getCSS()),\r\n            \"name\": \"frameMousePanel\",\r\n            \"class\": name,\r\n            \"$\": function (element) { layout.frameMousePanel = element; }\r\n          },\r\n          [\"div\", /* frameplaceholder - contents scalable panel */\r\n            {\r\n              \"style\": mergeObjects({\r\n                position: \"absolute\",\r\n                overflow: \"hidden\"\r\n              },\r\n                viewportRect.getCSS()),\r\n              \"name\": \"framePlaceholder\",\r\n              \"class\": [\"frameplaceholder\", name],\r\n              \"$\": function (element) { layout.framePlaceholder = element; }\r\n            }\r\n          ]\r\n        ],\r\n        [\"div\", /* titlesMousePanel - titles mouse tracking events panel */\r\n          {\r\n            \"style\": mergeObjects({\r\n              position: \"absolute\",\r\n              overflow: \"hidden\"\r\n            },\r\n              viewportRect.getCSS()),\r\n            \"name\": \"titlesMousePanel\",\r\n            \"class\": [\"bp-titles-frame\", name],\r\n            \"$\": function (element) { layout.titlesMousePanel = element; }\r\n          },\r\n          [\"div\", /* titlesplaceholder - contents scalable panel */\r\n            {\r\n              \"style\": mergeObjects({\r\n                position: \"absolute\",\r\n                overflow: \"hidden\"\r\n              },\r\n                viewportRect.getCSS()),\r\n              \"name\": \"titlesPlaceholder\",\r\n              \"class\": [\"titlesplaceholder\", name],\r\n              \"$\": function (element) { layout.titlesPlaceholder = element; }\r\n            }\r\n          ]\r\n        ],\r\n        [\"div\", /* scrollPanel - root scroll panel */\r\n          {\r\n            \"style\": mergeObjects({\r\n              position: \"absolute\",\r\n              \"overflow\": \"auto\",\r\n              \"-webkit-overflow-scrolling\": \"touch\",\r\n              \"top\": \"0px\",\r\n              \"left\": \"0px\",\r\n              \"width\": viewportRect.width + \"px\",\r\n              \"height\": viewportRect.height + \"px\"\r\n            },\r\n              viewportRect.getCSS()),\r\n            \"name\": \"scrollPanel\",\r\n            \"class\": name,\r\n            \"$\": function (element) { layout.scrollPanel = element; }\r\n          },\r\n          [\"div\", /* mousePanel - mouse tracking events panel */\r\n            {\r\n              \"style\": mergeObjects({\r\n                position: \"absolute\",\r\n                overflow: \"visible\"\r\n              },\r\n                viewportRect.getCSS()),\r\n              \"name\": \"mousePanel\",\r\n              \"class\": name,\r\n              \"$\": function (element) { layout.mousePanel = element; }\r\n            },\r\n            [\"div\", /* placeholder - contents scalable panel */\r\n              {\r\n                \"style\": mergeObjects({\r\n                  position: \"absolute\",\r\n                  overflow: \"hidden\"\r\n                },\r\n                  viewportRect.getCSS()),\r\n                \"name\": \"placeholder\",\r\n                \"class\": [\"placeholder\", name],\r\n                \"$\": function (element) { layout.placeholder = element; }\r\n              },\r\n              [\"div\", /* calloutPlaceholder - callout panel */\r\n                {\r\n                  \"style\": {\r\n                    position: \"absolute\",\r\n                    overflow: \"visible\",\r\n                    top: \"0px\",\r\n                    left: \"0px\",\r\n                    width: \"0px\",\r\n                    height: \"0px\"\r\n                  },\r\n                  \"name\": \"calloutPlaceholder\",\r\n                  \"class\": [\"calloutplaceholder\", name],\r\n                  \"$\": function (element) { layout.calloutPlaceholder = element; }\r\n                }\r\n              ]\r\n            ]\r\n          ]\r\n        ]\r\n      ])\r\n    );\r\n  }\r\n\r\n  function cleanLayout() {\r\n    var controlPanel = _data.layout.controlPanel;\r\n    if (controlPanel != null) {\r\n      var parent = controlPanel.parentNode;\r\n      if (parent != null) {\r\n        parent.removeChild(controlPanel);\r\n      }\r\n    }\r\n  }\r\n\r\n  function bind(layout) {\r\n    layout.mousePanel.addEventListener('mousemove', onMouseMove);\r\n    layout.mousePanel.addEventListener('click', onMouseClick);\r\n    layout.mousePanel.addEventListener('dblclick', onMouseDblClick);\r\n    layout.mousePanel.addEventListener('change', onCheckboxChange);\r\n\r\n    layout.element.addEventListener('keydown', onKeyDown);\r\n\r\n    layout.scrollPanel.addEventListener('scroll', onScroll);\r\n\r\n    if (_data.options.enablePanning && isChrome()) {\r\n      layout.scrollPanel.draggable = true;\r\n      layout.scrollPanel.addEventListener('dragstart', onDragStart);\r\n      layout.scrollPanel.addEventListener('drag', onDragScroll);\r\n      layout.scrollPanel.addEventListener('dragend', onDragScroll);\r\n      layout.scrollPanel.addEventListener('dragover', onDragOver);\r\n    }\r\n\r\n    layout.frameMousePanel.addEventListener('mousemove', onFrameMouseMove);\r\n    layout.frameMousePanel.addEventListener('click', onFrameMouseClick);\r\n  }\r\n\r\n  function unbind(layout) {\r\n    if (layout.mousePanel != null) {\r\n      layout.mousePanel.removeEventListener(\"mousemove\", onMouseMove);\r\n      layout.mousePanel.removeEventListener(\"click\", onMouseClick);\r\n      layout.mousePanel.removeEventListener(\"dblclick\", onMouseDblClick);\r\n      layout.mousePanel.removeEventListener(\"change\", onCheckboxChange);\r\n    }\r\n    if (layout.element != null) {\r\n      layout.element.removeEventListener(\"keydown\", onKeyDown);\r\n    }\r\n    if (layout.scrollPanel != null) {\r\n      layout.scrollPanel.removeEventListener(\"scroll\", onScroll);\r\n      layout.scrollPanel.removeEventListener('dragstart', onDragStart);\r\n      layout.scrollPanel.removeEventListener('drag', onDragScroll);\r\n      layout.scrollPanel.removeEventListener('dragend', onDragScroll);\r\n      layout.scrollPanel.removeEventListener('dragover', onDragOver);\r\n    }\r\n\r\n    if (layout.frameMousePanel != null) {\r\n      layout.frameMousePanel.removeEventListener('mousemove', onFrameMouseMove);\r\n      layout.frameMousePanel.removeEventListener('click', onFrameMouseClick);\r\n    }\r\n  }\r\n\r\n  function onFrameMouseMove(event) {\r\n    var placeholderOffset = getElementOffset(_data.layout.frameMousePanel),\r\n      x = event.pageX - placeholderOffset.left,\r\n      y = event.pageY - placeholderOffset.top;\r\n    var projectItemsToFrameTask = _data.tasks.getTask(\"ProjectItemsToFrameTask\"),\r\n      highlightItemOptionTask = _data.tasks.getTask(\"HighlightItemOptionTask\"),\r\n      itemId;\r\n\r\n    if (highlightItemOptionTask.hasHighlightEnabled()) {\r\n      itemId = projectItemsToFrameTask.getTreeItemForMousePosition(x, y, highlightItemOptionTask.getGravityRadius());\r\n      setHighlightItem(event, itemId);\r\n    }\r\n  }\r\n\r\n  function onFrameMouseClick(event) {\r\n    var placeholderOffset = getElementOffset(_data.layout.frameMousePanel),\r\n      x = event.pageX - placeholderOffset.left,\r\n      y = event.pageY - placeholderOffset.top,\r\n      projectItemsToFrameTask = _data.tasks.getTask(\"ProjectItemsToFrameTask\"),\r\n      cursorItemOptionTask = _data.tasks.getTask(\"CursorItemOptionTask\"),\r\n      highlightItemOptionTask = _data.tasks.getTask(\"HighlightItemOptionTask\"),\r\n      newCursorItemId = projectItemsToFrameTask.getTreeItemForMousePosition(x, y, highlightItemOptionTask.getGravityRadius()),\r\n      target,\r\n      eventArgs;\r\n    target = event.target;\r\n    if (newCursorItemId !== null) {\r\n      eventArgs = getEventArgs(null, newCursorItemId);\r\n      trigger(\"onMouseClick\", event, eventArgs);\r\n      if (!eventArgs.cancel) {\r\n        if (cursorItemOptionTask.hasCursorEnabled()) {\r\n          setCursorItem(event, newCursorItemId);\r\n          _data.layout.element.focus();\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  function onMouseMove(event) {\r\n    var placeholderOffset = getElementOffset(_data.layout.mousePanel),\r\n      x = event.pageX - placeholderOffset.left,\r\n      y = event.pageY - placeholderOffset.top,\r\n      createTransformTask = _data.tasks.getTask(\"CreateTransformTask\"),\r\n      highlightItemOptionTask = _data.tasks.getTask(\"HighlightItemOptionTask\"),\r\n      itemId;\r\n\r\n    if (highlightItemOptionTask.hasHighlightEnabled()) {\r\n      itemId = createTransformTask.getTreeItemForMousePosition(x, y, highlightItemOptionTask.getGravityRadius());\r\n      setHighlightItem(event, itemId);\r\n    }\r\n  }\r\n\r\n  function onCheckboxChange(event) {\r\n    var target = event.target;\r\n    var selectedId = target.getAttribute(\"data-id\");\r\n    if (selectedId != null) {\r\n      var selectedItems = (_data.options.selectedItems || []).slice();\r\n      var eventArgs = getEventArgs(null, selectedId);\r\n      var position = selectedItems.findIndex(function(itemid) { return selectedId == itemid});\r\n      trigger(\"onSelectionChanging\", event, eventArgs);\r\n      if (!eventArgs.cancel) {\r\n        if (position >= 0) {\r\n          selectedItems.splice(position, 1);\r\n        }\r\n        else {\r\n          selectedItems.push(selectedId);\r\n        }\r\n        _data.options.selectedItems = selectedItems;\r\n\r\n        if (position < 0) {\r\n          target.setAttribute(\"checked\", \"checked\");\r\n        } else {\r\n          target.removeAttribute(\"checked\");\r\n        }\r\n\r\n        //refresh(false, false);\r\n\r\n        trigger(\"onSelectionChanged\", event, eventArgs);\r\n      }\r\n    }\r\n  }\r\n\r\n  function onMouseClick(event) {\r\n    var placeholderOffset = getElementOffset(_data.layout.mousePanel),\r\n      x = event.pageX - placeholderOffset.left,\r\n      y = event.pageY - placeholderOffset.top,\r\n      createTransformTask = _data.tasks.getTask(\"CreateTransformTask\"),\r\n      cursorItemOptionTask = _data.tasks.getTask(\"CursorItemOptionTask\"),\r\n      highlightItemOptionTask = _data.tasks.getTask(\"HighlightItemOptionTask\"),\r\n      newCursorItemId = createTransformTask.getTreeItemForMousePosition(x, y, highlightItemOptionTask.getGravityRadius()),\r\n      target,\r\n      buttonName,\r\n      eventArgs;\r\n    target = event.target;\r\n    if (newCursorItemId !== null) {\r\n      var buttonName = target.getAttribute(\"data-buttonname\");\r\n      if(isNullOrEmpty(buttonName)) {\r\n        buttonName = target.parentNode && target.parentNode.getAttribute(\"data-buttonname\");\r\n      };\r\n      if (!isNullOrEmpty(buttonName)) {\r\n        eventArgs = getEventArgs(null, newCursorItemId, buttonName);\r\n        trigger(\"onButtonClick\", event, eventArgs);\r\n      }\r\n      else if (target.getAttribute(\"name\") === \"checkbox\" || target.getAttribute(\"name\") === \"selectiontext\") { \r\n\r\n      }\r\n      else {\r\n        eventArgs = getEventArgs(null, newCursorItemId);\r\n        trigger(\"onMouseClick\", event, eventArgs);\r\n        if (!eventArgs.cancel) {\r\n          if (cursorItemOptionTask.hasCursorEnabled()) {\r\n            setCursorItem(event, newCursorItemId);\r\n            _data.layout.element.focus();\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  function onMouseDblClick(event) {\r\n    var eventArgs,\r\n      highlightItemTask = _data.tasks.getTask(\"HighlightItemTask\"),\r\n      highlightTreeItem = highlightItemTask.getHighlightTreeItem();\r\n\r\n    if (highlightTreeItem !== null) {\r\n      eventArgs = getEventArgs(null, highlightTreeItem);\r\n      trigger(\"onMouseDblClick\", event, eventArgs);\r\n    }\r\n  }\r\n\r\n  function onKeyDown(event) {\r\n    var highlightItemTask = _data.tasks.getTask(\"HighlightItemTask\"),\r\n      highlightItemOptionTask = _data.tasks.getTask(\"HighlightItemOptionTask\"),\r\n      cursorItemTask = _data.tasks.getTask(\"CursorItemTask\"),\r\n      cursorItemOptionTask = _data.tasks.getTask(\"CursorItemOptionTask\"),\r\n      alignDiagramTask = _data.tasks.getTask('AlignDiagramTask'),\r\n      createTransformTask = _data.tasks.getTask('CreateTransformTask'),\r\n      transform = createTransformTask.getTransform(),\r\n      navigationItem = null,\r\n      newNavigationItem,\r\n      direction = null,\r\n      accepted,\r\n      layout = _data.layout;\r\n\r\n    if (highlightItemOptionTask.hasHighlightEnabled() && cursorItemOptionTask.hasCursorEnabled()) {\r\n      navigationItem = highlightItemTask.getHighlightTreeItem();\r\n      if (navigationItem === null) {\r\n        navigationItem = cursorItemTask.getCursorTreeItem();\r\n      }\r\n    } else if (highlightItemOptionTask.hasHighlightEnabled()) {\r\n      navigationItem = highlightItemTask.getHighlightTreeItem();\r\n    } else if (cursorItemOptionTask.hasCursorEnabled()) {\r\n      navigationItem = cursorItemTask.getCursorTreeItem();\r\n    }\r\n\r\n\r\n    if (navigationItem != null) {\r\n      switch (event.which) {\r\n        case 13: /*Enter*/\r\n          if (cursorItemOptionTask.hasCursorEnabled()) {\r\n            setCursorItem(event, navigationItem);\r\n            event.preventDefault();\r\n            layout.element.focus();\r\n          }\r\n          break;\r\n        case 40: /*Down*/\r\n          direction = OrientationType.Bottom;\r\n          break;\r\n        case 38: /*Up*/\r\n          direction = OrientationType.Top;\r\n          break;\r\n        case 37: /*Left*/\r\n          direction = OrientationType.Left;\r\n          break;\r\n        case 39: /*Right*/\r\n          direction = OrientationType.Right;\r\n          break;\r\n      }\r\n\r\n      if (direction != null) {\r\n\r\n        accepted = false;\r\n\r\n        while (!accepted) {\r\n          accepted = true;\r\n\r\n          direction = transform.getOrientation(direction);\r\n          newNavigationItem = alignDiagramTask.getNextItem(navigationItem, direction);\r\n\r\n          if (newNavigationItem != null) {\r\n            event.preventDefault();\r\n            if (highlightItemOptionTask.hasHighlightEnabled()) {\r\n              setHighlightItem(event, newNavigationItem);\r\n            } else if (cursorItemOptionTask.hasCursorEnabled()) {\r\n              setCursorItem(event, newNavigationItem);\r\n            }\r\n\r\n          }\r\n        }\r\n        layout.element.focus();\r\n      }\r\n    }\r\n  }\r\n\r\n  function onDragStart(event) {\r\n    var scrollPanel = _data.layout.scrollPanel;\r\n    _dragFrom = new Point(event.clientX, event.clientY);\r\n    _scrollFrom = new Point(scrollPanel.scrollLeft, scrollPanel.scrollTop);\r\n    _dragImage = _dragImage || new Image(); \r\n    event.dataTransfer.setDragImage(_dragImage, 0, 0);\r\n  }\r\n\r\n  function onDragOver(event) {\r\n    event.preventDefault();\r\n    event.dataTransfer.dropEffect = \"move\";\r\n  }\r\n\r\n  function onDragScroll(event) {\r\n    _scrollTo = new Point(_scrollFrom.x - (event.clientX - _dragFrom.x), _scrollFrom.y - (event.clientY - _dragFrom.y));\r\n    if (_dragTimer == null) {\r\n      _dragTimer = window.setTimeout(function () {\r\n        var scrollPanel = _data.layout.scrollPanel;\r\n        scrollPanel.scrollLeft = _scrollTo.x;\r\n        scrollPanel.scrollTop = _scrollTo.y;\r\n        window.clearTimeout(_dragTimer);\r\n        _dragTimer = null;\r\n      }, 50);\r\n    }\r\n  }\r\n\r\n  function setHighlightItem(event, newHighlightItemId) {\r\n    var result = true,\r\n      eventArgs;\r\n    if (newHighlightItemId !== null) {\r\n      if (newHighlightItemId !== _data.options.highlightItem) {\r\n        eventArgs = getEventArgs(_data.options.highlightItem, newHighlightItemId);\r\n\r\n        _data.options.highlightItem = newHighlightItemId;\r\n\r\n        trigger(\"onHighlightChanging\", event, eventArgs);\r\n\r\n        if (!eventArgs.cancel) {\r\n          refresh(false, false);\r\n\r\n          trigger(\"onHighlightChanged\", event, eventArgs);\r\n        } else {\r\n          result = false;\r\n        }\r\n      }\r\n    } else {\r\n      if (_data.options.highlightItem !== null) {\r\n        eventArgs = getEventArgs(_data.options.highlightItem, null);\r\n\r\n        _data.options.highlightItem = null;\r\n\r\n        trigger(\"onHighlightChanging\", event, eventArgs);\r\n\r\n        if (!eventArgs.cancel) {\r\n          refresh(false, false);\r\n\r\n          trigger(\"onHighlightChanged\", event, eventArgs);\r\n        } else {\r\n          result = false;\r\n        }\r\n      }\r\n    }\r\n    return result;\r\n  }\r\n\r\n  function setCursorItem(event, newCursorItemId) {\r\n    var eventArgs;\r\n    if (newCursorItemId !== _data.options.cursorItem) {\r\n      eventArgs = getEventArgs(_data.options.cursorItem, newCursorItemId);\r\n\r\n      _data.options.cursorItem = newCursorItemId;\r\n\r\n      trigger(\"onCursorChanging\", event, eventArgs);\r\n\r\n      if (!eventArgs.cancel) {\r\n        refresh(true, _debug);\r\n\r\n        trigger(\"onCursorChanged\", event, eventArgs);\r\n      }\r\n    }\r\n  }\r\n\r\n  function getEventArgs(oldTreeItemId, newTreeItemId, name) {\r\n    return eventArgsFactory(_data, oldTreeItemId, newTreeItemId, name);\r\n  }\r\n\r\n  function trigger(eventHandlerName, event, eventArgs) {\r\n    var eventHandler = _data.options[eventHandlerName];\r\n    if (eventHandler != null) {\r\n      eventHandler(event, eventArgs);\r\n    }\r\n  }\r\n\r\n  update(); /* init control on create */\r\n\r\n  return {\r\n    destroy: destroy,\r\n    setOptions: setOptions,\r\n    getOptions: getOptions,\r\n    setOption: setOption,\r\n    getOption: getOption,\r\n    update: update\r\n  };\r\n};\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}