{"ast":null,"code":"import Rect from '../../../graphics/structs/Rect';\nimport { VerticalAlignmentType, Visibility, GroupByType } from '../../../enums';\nimport FamilyAlignment from '../../../algorithms/FamilyAlignment';\nimport TreeLevelPosition from '../../../models/TreeLevelPosition';\nimport TreeItemPosition from '../../../models/TreeItemPosition';\nfunction ChildLayoutPosition(offset, leftPadding, rightPadding) {\n  this.offset = offset;\n  this.leftPadding = leftPadding;\n  this.rightPadding = rightPadding;\n}\nexport default function FamilyLayout(logicalFamily, treeLevels, getConnectorsStacksSizes) {\n  this.logicalFamily = logicalFamily; // Family of FamilyItem\n  this.treeLevels = treeLevels; // TreeLevels of OrgItem used properties: isVisible\n  this.getConnectorsStacksSizes = getConnectorsStacksSizes; // TreeLevelConnectorStackSize\n\n  this.treeLevelsPositions = [];\n  this.childLayoutsPositions = {};\n}\n;\nFamilyLayout.prototype.loop = function (thisArg, onItem) {\n  if (onItem != null) {\n    var zeroBasedLevelIndex = 0;\n    this.treeLevels.loopLevels(this, function (levelIndex) {\n      this.treeLevels.loopLevelItems(this, levelIndex, function (treeItemId, treeItem) {\n        onItem.call(thisArg, treeItem, zeroBasedLevelIndex);\n      });\n      zeroBasedLevelIndex += 1;\n    });\n  }\n};\nFamilyLayout.prototype.measure = function (levelVisibility, isCursor, isSelected, treeItemTemplate, treeItemsPositions, options) {\n  this.treeLevelsPositions = [];\n  this.treeLevels.loopLevels(this, function (index, levelContext) {\n    var treeLevelPosition = new TreeLevelPosition();\n    this.treeLevelsPositions.push(treeLevelPosition);\n  });\n  this.setOffsets(this.treeLevels, treeItemsPositions, this.childLayoutsPositions, this.treeLevelsPositions, this.logicalFamily, options.intervals, options.padding);\n  this.setLevelsDepth(this.treeLevels, treeItemsPositions, this.treeLevelsPositions, options.verticalAlignment);\n  this.shiftLevels(this.treeLevelsPositions, options.padding.top, options.shifts, options.arrowsDirection, options.linesWidth, this.getConnectorsStacksSizes);\n  var treeItemPosition = new TreeItemPosition();\n  treeItemPosition.actualVisibility = Visibility.Normal;\n  treeItemPosition.actualSize = this.getLayoutSize(this.treeLevels, treeItemsPositions, this.childLayoutsPositions, this.treeLevelsPositions, options.padding);\n  return treeItemPosition;\n};\nFamilyLayout.prototype.getLayoutSize = function (treeLevels, treeItemsPositions, childLayoutsPositions, treeLevelsPositions, padding) {\n  return new Rect(0, 0, Math.round(this.getLayoutWidth(treeLevels, treeItemsPositions, childLayoutsPositions, padding)), Math.round(this.getLayoutHeight(treeLevelsPositions, padding)));\n};\nFamilyLayout.prototype.getLayoutWidth = function (treeLevels, treeItemsPositions, childLayoutsPositions, padding) {\n  var result = 0;\n  treeLevels.loopLevels(this, function (levelIndex, level) {\n    var levelLength = treeLevels.getLevelLength(levelIndex);\n    if (levelLength > 0) {\n      var itemId = treeLevels.getItemAtPosition(levelIndex, levelLength - 1),\n        treeItemPosition = treeItemsPositions[itemId],\n        childLayoutPosition = childLayoutsPositions[itemId];\n      result = Math.max(result, childLayoutPosition.offset + treeItemPosition.actualSize.width + padding.right);\n    }\n  });\n  return result;\n};\nFamilyLayout.prototype.getLayoutHeight = function (treeLevelsPositions, padding) {\n  var len = treeLevelsPositions.length,\n    treeLevel = treeLevelsPositions[len - 1];\n  return treeLevel.getNodesBottom() + padding.bottom;\n};\nFamilyLayout.prototype.setLevelsDepth = function (treeLevels, treeItemsPositions, treeLevelsPositions, verticalAlignment) {\n  var minimalDepth, dotsDepth;\n  treeLevels.loopLevels(this, function (levelIndex, treeLevel) {\n    var treeLevelPosition = treeLevelsPositions[levelIndex];\n    treeLevelPosition.shift = 0.0;\n    treeLevelPosition.depth = 0.0;\n    treeLevelPosition.actualVisibility = Visibility.Invisible;\n    minimalDepth = null; /* minimum  height of non-dot items in level */\n    dotsDepth = null; /* maximum dots height */\n\n    treeLevels.loopLevelItems(this, levelIndex, function (itemid, treeItem, position) {\n      var treeItemPosition = treeItemsPositions[itemid];\n      treeLevelPosition.depth = Math.max(treeLevelPosition.depth, treeItemPosition.actualSize.height);\n      switch (treeItemPosition.actualVisibility) {\n        case Visibility.Dot:\n        case Visibility.Line:\n        case Visibility.Invisible:\n          dotsDepth = !dotsDepth ? treeItemPosition.actualSize.height : Math.min(dotsDepth, treeItemPosition.actualSize.height);\n          break;\n        default:\n          minimalDepth = !minimalDepth ? treeItemPosition.actualSize.height : Math.min(minimalDepth, treeItemPosition.actualSize.height);\n          break;\n      }\n      treeLevelPosition.actualVisibility = Math.min(treeLevelPosition.actualVisibility, treeItemPosition.actualVisibility);\n    });\n    if (minimalDepth == null) {\n      minimalDepth = treeLevelPosition.depth;\n    }\n    if (dotsDepth != null && dotsDepth > minimalDepth) {\n      minimalDepth = dotsDepth;\n    }\n    switch (verticalAlignment) {\n      case VerticalAlignmentType.Top:\n        treeLevelPosition.horizontalConnectorsDepth = minimalDepth / 2.0;\n        break;\n      case VerticalAlignmentType.Middle:\n        treeLevelPosition.horizontalConnectorsDepth = treeLevelPosition.depth / 2.0;\n        break;\n      case VerticalAlignmentType.Bottom:\n        treeLevelPosition.horizontalConnectorsDepth = treeLevelPosition.depth - minimalDepth / 2.0;\n        break;\n    }\n  });\n};\nFamilyLayout.prototype.shiftLevels = function (treeLevelsPositions, shift, shifts, arrowsDirection, linesWidth, getConnectorsStacksSizes) {\n  var index,\n    len,\n    treeLevelPosition,\n    parentsStackSize,\n    childrenSpace = 0,\n    parentsSpace = 0,\n    arrowTipLength = linesWidth * 8;\n  switch (arrowsDirection) {\n    case GroupByType.Parents:\n      childrenSpace = arrowTipLength;\n      parentsSpace = 0;\n      break;\n    case GroupByType.Children:\n      childrenSpace = 0;\n      parentsSpace = arrowTipLength;\n      break;\n  }\n  for (index = 0, len = treeLevelsPositions.length; index < len; index += 1) {\n    treeLevelPosition = treeLevelsPositions[index];\n    parentsStackSize = getConnectorsStacksSizes(index).parentsStackSize;\n    shift += treeLevelPosition.setShift(shift, shifts[treeLevelPosition.actualVisibility], parentsSpace, childrenSpace, parentsStackSize);\n  }\n};\nFamilyLayout.prototype.setOffsets = function (treeLevels, treeItemsPositions, childLayoutsPositions, treeLevelsPositions, logicalFamily, intervals, padding) {\n  var index, len;\n  for (index = 0, len = treeLevelsPositions.length; index < len; index += 1) {\n    treeLevelsPositions[index].currentOffset = 0.0;\n  }\n  var family = logicalFamily.getPlanarFamily(treeLevels);\n  var familyAlignment = new FamilyAlignment(this, family, treeLevels, function (nodeId, node) {\n    var treeItemPosition = treeItemsPositions[nodeId];\n    var treeItemPadding = intervals[treeItemPosition.actualVisibility] / 2;\n    childLayoutsPositions[nodeId] = new ChildLayoutPosition(0, treeItemPadding, treeItemPadding);\n    return treeItemPadding + treeItemPosition.actualSize.width + treeItemPadding;\n  });\n  var leftMargin = null;\n  treeLevels.loopLevels(this, function (levelIndex, level) {\n    var nodeId = treeLevels.getItemAtPosition(levelIndex, 0);\n    if (nodeId != null) {\n      var treeItemPosition = treeItemsPositions[nodeId];\n      var nodeOffset = familyAlignment.getOffset(nodeId) - treeItemPosition.actualSize.width / 2;\n      leftMargin = leftMargin === null ? nodeOffset : Math.min(leftMargin, nodeOffset);\n    }\n  });\n  treeLevels.loopLevels(this, function (levelIndex, level) {\n    treeLevels.loopLevelItems(this, levelIndex, function (nodeId, node, position) {\n      var treeItemPosition = treeItemsPositions[nodeId];\n      var nodeOffset = familyAlignment.getOffset(nodeId);\n      childLayoutsPositions[nodeId].offset = nodeOffset - treeItemPosition.actualSize.width / 2 - leftMargin + padding.left;\n    });\n  });\n};\nFamilyLayout.prototype.arrange = function (thisArg, position, layoutDirection, treeItemsPositions, options, onItemPositioned) {\n  var prevLevelPosition = null;\n  if (onItemPositioned != null) {\n    this.treeLevels.loopLevels(this, function (levelIndex, treeLevel) {\n      var treeLevelPosition = this.treeLevelsPositions[levelIndex];\n      this.treeLevels.loopLevelItems(this, levelIndex, function (itemId, treeItem, position) {\n        var treeItemPosition = treeItemsPositions[itemId];\n        var childLayoutPosition = this.childLayoutsPositions[itemId];\n        var result = this.getItemPosition(treeItemPosition.actualVisibility, childLayoutPosition.offset, treeItemPosition.actualSize, prevLevelPosition, treeLevelPosition, options.verticalAlignment);\n        onItemPositioned.call(thisArg, itemId, {\n          ...treeItemPosition,\n          ...result\n        });\n      });\n      prevLevelPosition = treeLevelPosition;\n    });\n  }\n};\nFamilyLayout.prototype.getItemPosition = function (visibility, offset, size, prevLevel, level, verticalAlignment) {\n  var itemShift = 0;\n  switch (visibility) {\n    case Visibility.Normal:\n      switch (verticalAlignment) {\n        case VerticalAlignmentType.Top:\n          itemShift = 0;\n          break;\n        case VerticalAlignmentType.Middle:\n          itemShift = (level.depth - size.height) / 2.0;\n          break;\n        case VerticalAlignmentType.Bottom:\n          itemShift = level.depth - size.height;\n          break;\n      }\n      break;\n    case Visibility.Dot:\n    case Visibility.Line:\n    case Visibility.Invisible:\n      itemShift = level.horizontalConnectorsDepth - size.height / 2.0;\n      break;\n  }\n  return {\n    actualPosition: new Rect(offset, level.shift + itemShift, size.width, size.height),\n    horizontalConnectorsShift: level.shift + level.horizontalConnectorsDepth,\n    topConnectorShift: prevLevel != null ? prevLevel.shift + prevLevel.connectorShift : null,\n    topConnectorInterval: prevLevel != null ? prevLevel.levelSpace / 2 : null,\n    bottomConnectorShift: level.shift + level.connectorShift,\n    bottomConnectorInterval: level.levelSpace / 2\n  };\n};","map":{"version":3,"names":["Rect","VerticalAlignmentType","Visibility","GroupByType","FamilyAlignment","TreeLevelPosition","TreeItemPosition","ChildLayoutPosition","offset","leftPadding","rightPadding","FamilyLayout","logicalFamily","treeLevels","getConnectorsStacksSizes","treeLevelsPositions","childLayoutsPositions","prototype","loop","thisArg","onItem","zeroBasedLevelIndex","loopLevels","levelIndex","loopLevelItems","treeItemId","treeItem","call","measure","levelVisibility","isCursor","isSelected","treeItemTemplate","treeItemsPositions","options","index","levelContext","treeLevelPosition","push","setOffsets","intervals","padding","setLevelsDepth","verticalAlignment","shiftLevels","top","shifts","arrowsDirection","linesWidth","treeItemPosition","actualVisibility","Normal","actualSize","getLayoutSize","Math","round","getLayoutWidth","getLayoutHeight","result","level","levelLength","getLevelLength","itemId","getItemAtPosition","childLayoutPosition","max","width","right","len","length","treeLevel","getNodesBottom","bottom","minimalDepth","dotsDepth","shift","depth","Invisible","itemid","position","height","Dot","Line","min","Top","horizontalConnectorsDepth","Middle","Bottom","parentsStackSize","childrenSpace","parentsSpace","arrowTipLength","Parents","Children","setShift","currentOffset","family","getPlanarFamily","familyAlignment","nodeId","node","treeItemPadding","leftMargin","nodeOffset","getOffset","left","arrange","layoutDirection","onItemPositioned","prevLevelPosition","getItemPosition","visibility","size","prevLevel","itemShift","actualPosition","horizontalConnectorsShift","topConnectorShift","connectorShift","topConnectorInterval","levelSpace","bottomConnectorShift","bottomConnectorInterval"],"sources":["/Users/iamnestyyy/ReactProjects/orgchart/node_modules/basicprimitives/src/tasks/transformations/layouts/FamilyLayout.js"],"sourcesContent":["import Rect from '../../../graphics/structs/Rect';\r\nimport { VerticalAlignmentType, Visibility, GroupByType } from '../../../enums';\r\nimport FamilyAlignment from '../../../algorithms/FamilyAlignment';\r\nimport TreeLevelPosition from '../../../models/TreeLevelPosition';\r\nimport TreeItemPosition from '../../../models/TreeItemPosition';\r\n\r\nfunction ChildLayoutPosition( offset, leftPadding, rightPadding ) {\r\n  this.offset = offset;\r\n  this.leftPadding = leftPadding;\r\n  this.rightPadding = rightPadding;\r\n}\r\n\r\nexport default function FamilyLayout(logicalFamily, treeLevels, getConnectorsStacksSizes) {\r\n  this.logicalFamily = logicalFamily; // Family of FamilyItem\r\n  this.treeLevels = treeLevels; // TreeLevels of OrgItem used properties: isVisible\r\n  this.getConnectorsStacksSizes = getConnectorsStacksSizes; // TreeLevelConnectorStackSize\r\n\r\n  this.treeLevelsPositions = [];\r\n  this.childLayoutsPositions = {};\r\n};\r\n\r\nFamilyLayout.prototype.loop = function (thisArg, onItem) {\r\n  if(onItem != null) {\r\n    var zeroBasedLevelIndex = 0;\r\n    this.treeLevels.loopLevels(this, function (levelIndex) {\r\n      this.treeLevels.loopLevelItems(this, levelIndex, function (treeItemId, treeItem) {\r\n        onItem.call(thisArg, treeItem, zeroBasedLevelIndex);\r\n      });\r\n      zeroBasedLevelIndex+=1;\r\n    });\r\n  }\r\n};\r\n\r\n\r\nFamilyLayout.prototype.measure = function (levelVisibility, isCursor, isSelected, treeItemTemplate, treeItemsPositions, options) {\r\n  this.treeLevelsPositions = [];\r\n\r\n  this.treeLevels.loopLevels(this, function (index, levelContext) {\r\n    var treeLevelPosition = new TreeLevelPosition();\r\n    this.treeLevelsPositions.push(treeLevelPosition);\r\n  });\r\n\r\n  this.setOffsets(this.treeLevels, treeItemsPositions, this.childLayoutsPositions, this.treeLevelsPositions, this.logicalFamily, options.intervals, options.padding);\r\n  this.setLevelsDepth(this.treeLevels, treeItemsPositions, this.treeLevelsPositions, options.verticalAlignment);\r\n  this.shiftLevels(this.treeLevelsPositions, options.padding.top, options.shifts, options.arrowsDirection, options.linesWidth, this.getConnectorsStacksSizes);\r\n\r\n  var treeItemPosition = new TreeItemPosition();\r\n  treeItemPosition.actualVisibility = Visibility.Normal;\r\n  treeItemPosition.actualSize = this.getLayoutSize(this.treeLevels, treeItemsPositions, this.childLayoutsPositions, this.treeLevelsPositions, options.padding);\r\n  return treeItemPosition;\r\n};\r\n\r\nFamilyLayout.prototype.getLayoutSize = function (treeLevels, treeItemsPositions, childLayoutsPositions, treeLevelsPositions, padding) {\r\n  return new Rect(0, 0, Math.round(this.getLayoutWidth(treeLevels, treeItemsPositions, childLayoutsPositions, padding)), Math.round(this.getLayoutHeight(treeLevelsPositions, padding)));\r\n};\r\n\r\nFamilyLayout.prototype.getLayoutWidth = function (treeLevels, treeItemsPositions, childLayoutsPositions, padding) {\r\n  var result = 0;\r\n  treeLevels.loopLevels(this, function (levelIndex, level) {\r\n    var levelLength = treeLevels.getLevelLength(levelIndex);\r\n\r\n    if (levelLength > 0) {\r\n      var itemId = treeLevels.getItemAtPosition(levelIndex, levelLength - 1),\r\n        treeItemPosition = treeItemsPositions[itemId],\r\n        childLayoutPosition = childLayoutsPositions[itemId];\r\n      result = Math.max(result, childLayoutPosition.offset + treeItemPosition.actualSize.width + padding.right);\r\n    }\r\n  });\r\n  return result;\r\n};\r\n\r\nFamilyLayout.prototype.getLayoutHeight = function (treeLevelsPositions, padding) {\r\n  var len = treeLevelsPositions.length,\r\n    treeLevel = treeLevelsPositions[len - 1];\r\n  return treeLevel.getNodesBottom() + padding.bottom;\r\n};\r\n\r\nFamilyLayout.prototype.setLevelsDepth = function (treeLevels, treeItemsPositions, treeLevelsPositions, verticalAlignment) {\r\n  var minimalDepth,\r\n    dotsDepth;\r\n\r\n  treeLevels.loopLevels(this, function (levelIndex, treeLevel) {\r\n    var treeLevelPosition = treeLevelsPositions[levelIndex];\r\n    treeLevelPosition.shift = 0.0;\r\n    treeLevelPosition.depth = 0.0;\r\n    treeLevelPosition.actualVisibility = Visibility.Invisible;\r\n\r\n    minimalDepth = null; /* minimum  height of non-dot items in level */\r\n    dotsDepth = null; /* maximum dots height */\r\n\r\n    treeLevels.loopLevelItems(this, levelIndex, function (itemid, treeItem, position) {\r\n      var treeItemPosition = treeItemsPositions[itemid];\r\n      treeLevelPosition.depth = Math.max(treeLevelPosition.depth, treeItemPosition.actualSize.height);\r\n      switch (treeItemPosition.actualVisibility) {\r\n        case Visibility.Dot:\r\n        case Visibility.Line:\r\n        case Visibility.Invisible:\r\n          dotsDepth = !dotsDepth ? treeItemPosition.actualSize.height : Math.min(dotsDepth, treeItemPosition.actualSize.height);\r\n          break;\r\n        default:\r\n          minimalDepth = !minimalDepth ? treeItemPosition.actualSize.height : Math.min(minimalDepth, treeItemPosition.actualSize.height);\r\n          break;\r\n      }\r\n\r\n      treeLevelPosition.actualVisibility = Math.min(treeLevelPosition.actualVisibility, treeItemPosition.actualVisibility);\r\n    });\r\n\r\n    if (minimalDepth == null) {\r\n      minimalDepth = treeLevelPosition.depth;\r\n    }\r\n    if (dotsDepth != null && dotsDepth > minimalDepth) {\r\n      minimalDepth = dotsDepth;\r\n    }\r\n\r\n    switch (verticalAlignment) {\r\n      case VerticalAlignmentType.Top:\r\n        treeLevelPosition.horizontalConnectorsDepth = minimalDepth / 2.0;\r\n        break;\r\n      case VerticalAlignmentType.Middle:\r\n        treeLevelPosition.horizontalConnectorsDepth = treeLevelPosition.depth / 2.0;\r\n        break;\r\n      case VerticalAlignmentType.Bottom:\r\n        treeLevelPosition.horizontalConnectorsDepth = treeLevelPosition.depth - minimalDepth / 2.0;\r\n        break;\r\n    }\r\n  });\r\n};\r\n\r\nFamilyLayout.prototype.shiftLevels = function (treeLevelsPositions, shift, shifts, arrowsDirection, linesWidth, getConnectorsStacksSizes) {\r\n  var index,\r\n    len,\r\n    treeLevelPosition,\r\n    parentsStackSize,\r\n    childrenSpace = 0,\r\n    parentsSpace = 0,\r\n    arrowTipLength = linesWidth * 8;\r\n\r\n  switch (arrowsDirection) {\r\n    case GroupByType.Parents:\r\n      childrenSpace = arrowTipLength;\r\n      parentsSpace = 0;\r\n      break;\r\n    case GroupByType.Children:\r\n      childrenSpace = 0;\r\n      parentsSpace = arrowTipLength;\r\n      break;\r\n  }\r\n\r\n  for (index = 0, len = treeLevelsPositions.length; index < len; index += 1) {\r\n    treeLevelPosition = treeLevelsPositions[index];\r\n    parentsStackSize = getConnectorsStacksSizes(index).parentsStackSize;\r\n    shift += treeLevelPosition.setShift(shift, shifts[treeLevelPosition.actualVisibility], parentsSpace, childrenSpace, parentsStackSize);\r\n  }\r\n};\r\n\r\nFamilyLayout.prototype.setOffsets = function (treeLevels, treeItemsPositions, childLayoutsPositions, treeLevelsPositions, logicalFamily, intervals, padding) {\r\n  var index, len;\r\n\r\n  for (index = 0, len = treeLevelsPositions.length; index < len; index += 1) {\r\n    treeLevelsPositions[index].currentOffset = 0.0;\r\n  }\r\n\r\n  var family = logicalFamily.getPlanarFamily(treeLevels);\r\n\r\n  var familyAlignment = new FamilyAlignment(this, family, treeLevels, function (nodeId, node) {\r\n    var treeItemPosition = treeItemsPositions[nodeId];\r\n\r\n    var treeItemPadding = intervals[treeItemPosition.actualVisibility] / 2;\r\n    childLayoutsPositions[nodeId] = new ChildLayoutPosition(0, treeItemPadding, treeItemPadding);\r\n\r\n    return treeItemPadding + treeItemPosition.actualSize.width + treeItemPadding;\r\n  });\r\n\r\n  var leftMargin = null;\r\n  treeLevels.loopLevels(this, function (levelIndex, level) {\r\n    var nodeId = treeLevels.getItemAtPosition(levelIndex, 0);\r\n    if (nodeId != null) {\r\n      var treeItemPosition = treeItemsPositions[nodeId];\r\n      var nodeOffset = familyAlignment.getOffset(nodeId) - treeItemPosition.actualSize.width / 2;\r\n      leftMargin = (leftMargin === null) ? nodeOffset : Math.min(leftMargin, nodeOffset);\r\n    }\r\n  });\r\n\r\n  treeLevels.loopLevels(this, function (levelIndex, level) {\r\n    treeLevels.loopLevelItems(this, levelIndex, function (nodeId, node, position) {\r\n      var treeItemPosition = treeItemsPositions[nodeId];\r\n      var nodeOffset = familyAlignment.getOffset(nodeId);\r\n      childLayoutsPositions[nodeId].offset = nodeOffset - treeItemPosition.actualSize.width / 2 - leftMargin + padding.left;\r\n    });\r\n  });\r\n};\r\n\r\nFamilyLayout.prototype.arrange = function (thisArg, position, layoutDirection, treeItemsPositions, options, onItemPositioned) {\r\n  var prevLevelPosition = null;\r\n  if (onItemPositioned != null) {\r\n    this.treeLevels.loopLevels(this, function (levelIndex, treeLevel) {\r\n      var treeLevelPosition = this.treeLevelsPositions[levelIndex];\r\n\r\n      this.treeLevels.loopLevelItems(this, levelIndex, function (itemId, treeItem, position) {\r\n        var treeItemPosition = treeItemsPositions[itemId];\r\n        var childLayoutPosition = this.childLayoutsPositions[itemId];\r\n        var result = this.getItemPosition(treeItemPosition.actualVisibility, childLayoutPosition.offset, treeItemPosition.actualSize, prevLevelPosition, treeLevelPosition, options.verticalAlignment);\r\n\r\n        onItemPositioned.call(thisArg, itemId, { ...treeItemPosition, ...result});\r\n      });\r\n\r\n      prevLevelPosition = treeLevelPosition;\r\n    });\r\n  }\r\n};\r\n\r\nFamilyLayout.prototype.getItemPosition = function (visibility, offset, size, prevLevel, level, verticalAlignment) {\r\n  var itemShift = 0;\r\n\r\n  switch (visibility) {\r\n    case Visibility.Normal:\r\n      switch (verticalAlignment) {\r\n        case VerticalAlignmentType.Top:\r\n          itemShift = 0;\r\n          break;\r\n        case VerticalAlignmentType.Middle:\r\n          itemShift = (level.depth - size.height) / 2.0;\r\n          break;\r\n        case VerticalAlignmentType.Bottom:\r\n          itemShift = level.depth - size.height;\r\n          break;\r\n      }\r\n      break;\r\n    case Visibility.Dot:\r\n    case Visibility.Line:\r\n    case Visibility.Invisible:\r\n      itemShift = level.horizontalConnectorsDepth - size.height / 2.0;\r\n      break;\r\n  }\r\n\r\n  return {\r\n    actualPosition: new Rect(offset, level.shift + itemShift, size.width, size.height),\r\n    horizontalConnectorsShift: level.shift + level.horizontalConnectorsDepth,\r\n    topConnectorShift: prevLevel != null ? prevLevel.shift + prevLevel.connectorShift : null,\r\n    topConnectorInterval: prevLevel != null ? prevLevel.levelSpace / 2 : null,\r\n    bottomConnectorShift: level.shift + level.connectorShift,\r\n    bottomConnectorInterval: level.levelSpace / 2\r\n  };\r\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}