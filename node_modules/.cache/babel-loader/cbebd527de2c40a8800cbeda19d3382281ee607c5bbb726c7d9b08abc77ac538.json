{"ast":null,"code":"import ArrayReader from '../../../readers/ArrayReader';\nimport ValueReader from '../../../readers/ValueReader';\nimport { PageFitMode, Visibility } from '../../../enums';\nexport default function OrgNormalVisibilityItemsByMinimumVisibleLevelsTask(minimumVisibleLevelsOptionTask, orgTreeTask) {\n  var _data = {\n      items: []\n    },\n    _hash = {};\n  var _dataTemplate = new ArrayReader(new ValueReader([\"string\", \"number\"], true), true);\n  function process() {\n    var context = {\n        isChanged: false,\n        hash: _hash\n      },\n      orgTree = orgTreeTask.getOrgTree(),\n      {\n        pageFitMode,\n        minimalVisibility,\n        minimumVisibleLevels\n      } = minimumVisibleLevelsOptionTask.getOptions();\n    _data.items = _dataTemplate.read(_data.items, getSelectedItems(orgTree, pageFitMode, minimalVisibility, minimumVisibleLevels), \"items\", context);\n    return context.isChanged;\n  }\n  function getSelectedItems(orgTree, pageFitMode, minimalVisibility, minimumVisibleLevels) {\n    var result = [],\n      buckets = [];\n    if (minimumVisibleLevels > 0) {\n      if (PageFitMode.PageWidth == pageFitMode || PageFitMode.PageHeight || PageFitMode.FitToPage) {\n        if (minimalVisibility != Visibility.Normal) {\n          orgTree.loopLevels(this, function (nodeId, node, levelIndex) {\n            if (node.isVisible) {\n              var nodeLevel = levelIndex + node.levelOffset;\n              if (!buckets[nodeLevel]) {\n                buckets[nodeLevel] = [nodeId];\n              } else {\n                buckets[nodeLevel].push(nodeId);\n              }\n            }\n          });\n          var actualLevel = 0;\n          for (var index = 0; index < buckets.length; index += 1) {\n            if (buckets[index] != null) {\n              result = result.concat(buckets[index]);\n              actualLevel += 1;\n              if (actualLevel >= minimumVisibleLevels) {\n                break;\n              }\n            }\n          }\n        }\n      }\n    }\n    return result;\n  }\n  function getItems() {\n    return _data.items;\n  }\n  return {\n    process: process,\n    getItems: getItems\n  };\n}\n;","map":{"version":3,"names":["ArrayReader","ValueReader","PageFitMode","Visibility","OrgNormalVisibilityItemsByMinimumVisibleLevelsTask","minimumVisibleLevelsOptionTask","orgTreeTask","_data","items","_hash","_dataTemplate","process","context","isChanged","hash","orgTree","getOrgTree","pageFitMode","minimalVisibility","minimumVisibleLevels","getOptions","read","getSelectedItems","result","buckets","PageWidth","PageHeight","FitToPage","Normal","loopLevels","nodeId","node","levelIndex","isVisible","nodeLevel","levelOffset","push","actualLevel","index","length","concat","getItems"],"sources":["C:/Users/LCGI_15/Desktop/projects/nesty-orgchart/orgchart/node_modules/basicprimitives/src/tasks/transformations/selection/OrgNormalVisibilityItemsByMinimumVisibleLevelsTask.js"],"sourcesContent":["import ArrayReader from '../../../readers/ArrayReader';\r\nimport ValueReader from '../../../readers/ValueReader';\r\nimport { PageFitMode, Visibility } from '../../../enums';\r\n\r\nexport default function OrgNormalVisibilityItemsByMinimumVisibleLevelsTask(minimumVisibleLevelsOptionTask, orgTreeTask) {\r\n  var _data = {\r\n    items: []\r\n  },\r\n    _hash = {};\r\n\r\n  var _dataTemplate = new ArrayReader(\r\n    new ValueReader([\"string\", \"number\"], true),\r\n    true\r\n  );\r\n\r\n  function process() {\r\n    var context = {\r\n      isChanged: false,\r\n      hash: _hash\r\n    },\r\n    orgTree = orgTreeTask.getOrgTree(),\r\n    { pageFitMode, minimalVisibility, minimumVisibleLevels } = minimumVisibleLevelsOptionTask.getOptions();\r\n\r\n    _data.items = _dataTemplate.read(_data.items, getSelectedItems(orgTree, pageFitMode, minimalVisibility, minimumVisibleLevels), \"items\", context);\r\n\r\n    return context.isChanged;\r\n  }\r\n\r\n  function getSelectedItems(orgTree, pageFitMode, minimalVisibility, minimumVisibleLevels ) {\r\n    var result = [],\r\n      buckets = [];\r\n\r\n    if(minimumVisibleLevels > 0) {\r\n      if(PageFitMode.PageWidth == pageFitMode || PageFitMode.PageHeight || PageFitMode.FitToPage) {\r\n        if(minimalVisibility != Visibility.Normal) {\r\n          orgTree.loopLevels(this, function(nodeId, node, levelIndex) {\r\n            if(node.isVisible) {\r\n              var nodeLevel = levelIndex + node.levelOffset;\r\n              if(!buckets[nodeLevel]) {\r\n                buckets[nodeLevel] = [nodeId];\r\n              } else {\r\n                buckets[nodeLevel].push(nodeId);\r\n              }\r\n            }\r\n          });\r\n\r\n          var actualLevel = 0;\r\n          for(var index = 0; index < buckets.length; index+=1) {\r\n            if(buckets[index] != null) {\r\n              result = result.concat(buckets[index]);\r\n              actualLevel+=1;\r\n\r\n              if(actualLevel >= minimumVisibleLevels) {\r\n                break;\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n  function getItems() {\r\n    return _data.items;\r\n  }\r\n\r\n  return {\r\n    process: process,\r\n    getItems: getItems\r\n  };\r\n};"],"mappings":"AAAA,OAAOA,WAAW,MAAM,8BAA8B;AACtD,OAAOC,WAAW,MAAM,8BAA8B;AACtD,SAASC,WAAW,EAAEC,UAAU,QAAQ,gBAAgB;AAExD,eAAe,SAASC,kDAAkDA,CAACC,8BAA8B,EAAEC,WAAW,EAAE;EACtH,IAAIC,KAAK,GAAG;MACVC,KAAK,EAAE;IACT,CAAC;IACCC,KAAK,GAAG,CAAC,CAAC;EAEZ,IAAIC,aAAa,GAAG,IAAIV,WAAW,CACjC,IAAIC,WAAW,CAAC,CAAC,QAAQ,EAAE,QAAQ,CAAC,EAAE,IAAI,CAAC,EAC3C,IACF,CAAC;EAED,SAASU,OAAOA,CAAA,EAAG;IACjB,IAAIC,OAAO,GAAG;QACZC,SAAS,EAAE,KAAK;QAChBC,IAAI,EAAEL;MACR,CAAC;MACDM,OAAO,GAAGT,WAAW,CAACU,UAAU,CAAC,CAAC;MAClC;QAAEC,WAAW;QAAEC,iBAAiB;QAAEC;MAAqB,CAAC,GAAGd,8BAA8B,CAACe,UAAU,CAAC,CAAC;IAEtGb,KAAK,CAACC,KAAK,GAAGE,aAAa,CAACW,IAAI,CAACd,KAAK,CAACC,KAAK,EAAEc,gBAAgB,CAACP,OAAO,EAAEE,WAAW,EAAEC,iBAAiB,EAAEC,oBAAoB,CAAC,EAAE,OAAO,EAAEP,OAAO,CAAC;IAEhJ,OAAOA,OAAO,CAACC,SAAS;EAC1B;EAEA,SAASS,gBAAgBA,CAACP,OAAO,EAAEE,WAAW,EAAEC,iBAAiB,EAAEC,oBAAoB,EAAG;IACxF,IAAII,MAAM,GAAG,EAAE;MACbC,OAAO,GAAG,EAAE;IAEd,IAAGL,oBAAoB,GAAG,CAAC,EAAE;MAC3B,IAAGjB,WAAW,CAACuB,SAAS,IAAIR,WAAW,IAAIf,WAAW,CAACwB,UAAU,IAAIxB,WAAW,CAACyB,SAAS,EAAE;QAC1F,IAAGT,iBAAiB,IAAIf,UAAU,CAACyB,MAAM,EAAE;UACzCb,OAAO,CAACc,UAAU,CAAC,IAAI,EAAE,UAASC,MAAM,EAAEC,IAAI,EAAEC,UAAU,EAAE;YAC1D,IAAGD,IAAI,CAACE,SAAS,EAAE;cACjB,IAAIC,SAAS,GAAGF,UAAU,GAAGD,IAAI,CAACI,WAAW;cAC7C,IAAG,CAACX,OAAO,CAACU,SAAS,CAAC,EAAE;gBACtBV,OAAO,CAACU,SAAS,CAAC,GAAG,CAACJ,MAAM,CAAC;cAC/B,CAAC,MAAM;gBACLN,OAAO,CAACU,SAAS,CAAC,CAACE,IAAI,CAACN,MAAM,CAAC;cACjC;YACF;UACF,CAAC,CAAC;UAEF,IAAIO,WAAW,GAAG,CAAC;UACnB,KAAI,IAAIC,KAAK,GAAG,CAAC,EAAEA,KAAK,GAAGd,OAAO,CAACe,MAAM,EAAED,KAAK,IAAE,CAAC,EAAE;YACnD,IAAGd,OAAO,CAACc,KAAK,CAAC,IAAI,IAAI,EAAE;cACzBf,MAAM,GAAGA,MAAM,CAACiB,MAAM,CAAChB,OAAO,CAACc,KAAK,CAAC,CAAC;cACtCD,WAAW,IAAE,CAAC;cAEd,IAAGA,WAAW,IAAIlB,oBAAoB,EAAE;gBACtC;cACF;YACF;UACF;QACF;MACF;IACF;IAEA,OAAOI,MAAM;EACf;EAEA,SAASkB,QAAQA,CAAA,EAAG;IAClB,OAAOlC,KAAK,CAACC,KAAK;EACpB;EAEA,OAAO;IACLG,OAAO,EAAEA,OAAO;IAChB8B,QAAQ,EAAEA;EACZ,CAAC;AACH;AAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}